<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Andrew Rate" />

<meta name="date" content="2024-07-12" />

<title>Basic maps in R</title>

<script src="site_libs/header-attrs-2.17/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Sessions</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="about.html">For beginners</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Intro
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="intro.html">Intro</a>
    </li>
    <li>
      <a href="intro-GG.html">Intro+ggplot</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Plots
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="plots.html">Plots-baseR</a>
    </li>
    <li>
      <a href="plots-GG.html">Plots-ggplot</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Compare
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="means.html">Compare means (parametric)</a>
    </li>
    <li>
      <a href="nonparam.html">Non-parametric comparisons</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Relate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="correl.html">Correlation</a>
    </li>
    <li>
      <a href="regression.html">Simple linear regression</a>
    </li>
    <li>
      <a href="reg-group.html">Grouped linear regression</a>
    </li>
    <li>
      <a href="reg-multi.html">Multiple linear regression</a>
    </li>
    <li>
      <a href="timeseries.html">Time series analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Maps
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="maps.html">Map data with tile backgrounds</a>
    </li>
    <li>
      <a href="spatial.html">Spatial statistics</a>
    </li>
    <li>
      <a href="spat-interp.html">Spatial interpolation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Multi
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pca.html">Principal components analysis</a>
    </li>
    <li>
      <a href="vegan.html">Analysis of species presence-absence data</a>
    </li>
    <li>
      <a href="lda.html">Linear discriminant analysis</a>
    </li>
    <li>
      <a href="cluster.html">Cluster analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Util
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="tables.html">Tables &amp; trigger value counts</a>
    </li>
    <li>
      <a href="distributions.html">Distribution checking</a>
    </li>
    <li>
      <a href="residuals.html">Regression residuals to identify contamination</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://www.uwa.edu.au/schools/agriculture-and-environment">UWA School of Agriculture and Environment</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<!DOCTYPE html>

<html>
<body>
<h3><img src="./images/2015-UWA-Full-Hor-CMYK.png" alt="UWA logo" align="right"><span style="color:#003087;">Material to support teaching in Environmental Science<br />at The University of Western Australia</span></h3>
<h4><span style="color:#93721A;">Units ENVT3361, ENVT4461, and ENVT5503</span></h4></p>
</body>
</html>

<div id="header">



<h1 class="title toc-ignore">Basic maps in R</h1>
<h3 class="subtitle">Data plotted over tile backgrounds</h3>
<h4 class="author">Andrew Rate</h4>
<h4 class="date">2024-07-12</h4>

</div>


<style type="text/css">
  body{
  font-size: 12pt;
}
</style>
<div style="border: 2px solid #039; padding: 8px;">
<p style="text-align:center; font-size:12pt;">
<em>Maps / spatial pages</em>: <a href="maps.html"
style="color:#04b;">Maps</a> | <a href="spatial.html"
style="color:#04b;">Spatial statistics</a> | <a href="spat-interp.html"
style="color:#04b;">Spatial interpolation</a>
</p>
</div>
<p> </p>
<div id="activities-for-this-workshop-class" class="section level1"
style="border: 2px solid #039; background-color:#fec; padding: 8px;">
<h1>Activities for this Workshop class</h1>
<p><img src="./images/sample_loc_maps_afw19_afs19.png" align="right"
width="201" height="298" /> There are a few items available as learning
materials for this session on <strong>using R + packages to make
maps</strong>: two short videos, and two annotated pdfs based on</p>
<ol style="list-style-type: decimal">
<li>the R code and</li>
<li>a PowerPoint presentation.</li>
</ol>
<p>We suggest going through the first video first, and then trying the
code, and finally viewing the second video and trying some different
things. The material in the PowerPoint presentation on interpolation of
point data is completely optional.</p>
For activities today we suggest:
<ol>
<li>
Try to make a map of the Ashfield Flats Reserve area which covers all
our sample locations. A good place to start after watching the
video/reading the annotated code PDF would be with modifying and running
the R code.
</li>
</ol>
<p>
Good luck!
</p>
</div>
<p>
 
</p>
<div id="r-mapping---video-and-text-based-learning-materials"
class="section level2"
style="border: 2px solid #039; background-color:#fec; padding: 8px;">
<h2>R Mapping - video and text-based learning materials</h2>
<p>
<strong>Maps in R: Part 1 – Basics</strong>
</p>
<p>
<iframe width="320" height="240" allowfullscreen="allowfullscreen" frameborder="0" src="https://echo360.net.au/media/82aee36b-9476-419f-ba47-b25de5dfb9ef/public?autoplay=false&amp;automute=false">
</iframe>
</p>
<p>
<strong>The first ≈23 minutes are the most useful</strong>. After that,
some things have changed, even since 2023! If you want to try <span
style="font-family: &#39;courier new&#39;, courier, monospace;">ggmap</span>,
my Google Maps API Key will no longer work, and the Stamen maps are
sadly no longer available.
</p>
<p>
↓The best code for mapping using state-of-the-art <b>R</b> packages is
in the code in the rest of this page (below) ↓
</p>
</div>
<p>
 
</p>
<div
style="border: 2px solid #039; background-color:#fec; padding: 8px;">
<div id="files-to-download-for-this-workshop" class="section level3">
<h3>Files to download for this workshop</h3>
<p><a href="https://lms.uwa.edu.au/bbcswebdav/pid-3094285-dt-content-rid-40243674_1/xid-40243674_1" target="_blank" rel="noreferrer noopener"><img
src="./images/csv.png" alt="csv file icon" width="32"
height="32" />Ashfield Flats sediment soil data
<strong>2020</strong></a>    
<a href="https://lms.uwa.edu.au/bbcswebdav/pid-3094285-dt-content-rid-40243112_1/xid-40243112_1" target="_blank" rel="noreferrer noopener"><img
src="./images/rcode.png" alt="R code file icon" width="32"
height="32" /> Code used in video(s)</a></p>
<p><a href="https://lms.uwa.edu.au/bbcswebdav/pid-3094285-dt-content-rid-40243004_1/xid-40243004_1"><img
src="./images/csv.png" alt="csv file icon" width="32"
height="32" />&gt;Ashfield Flats sediment soil data 2019</a>    
<a href="https://lms.uwa.edu.au/bbcswebdav/pid-3094285-dt-content-rid-41529282_1/xid-41529282_1" target="_blank" rel="noopener"><img
src="./images/rcode.png" alt="R code file icon" width="32"
height="32" />Code for adding percentile bubbles to maps
(tricky!)</a> <strong>UPDATED 2023</strong></p>
</div>
<div id="bonus-material" class="section level3">
<h3>Bonus material</h3>
<p><span
style="font-family: cambria, serif; background-color:cyan; text-align: center;"> (Currently
on another Github site) </span></p>
<p>
<a href="https://raw.githubusercontent.com/Ratey-AtUWA/spatial/main/easy%20peasy%20afr%20map.R" target="_blank" rel="noopener"><img
src="./images/rcode.png" alt="R code file icon" width="32"
height="32" /> eezi-peazi Ashfield map (<strong>R</strong>
code)</a><br /> 
</p>
<p>
<a href="https://ratey-atuwa.github.io/cybloRg/georef_jpeg_map.html" target="_blank" rel="noopener"><img
src="./images/rcode.png" alt="R code file icon" width="32"
height="32" /></a> <a href="https://lms.uwa.edu.au/bbcswebdav/pid-3094285-dt-content-rid-42383985_1/xid-42383985_1" target="_blank" rel="noopener"><strong>R</strong>
code to use georeferenced images <em>(e.g</em>. from NearMap) as map
backgrounds</a><br /> 
</p>
<p>
<a href="https://ratey-atuwa.github.io/cybloRg/Google-kml-R.html" target="_blank" rel="noopener"><img
src="./images/rcode.png" alt="R code file icon" width="32"
height="32" /></a> <a href="https://ratey-atuwa.github.io/cybloRg/Google-kml-R.html" target="_blank" rel="noopener">Digitising
map features from Google Earth, and R code for a function to convert
Google Earth .kml files for use in <strong>R</strong></a>
</p>
<p>
<a href="https://ratey-atuwa.github.io/cybloRg/geostats.html" target="_blank" rel="noopener">Advanced
Spatial Analysis</a> (spatial autocorrelation, variograms, and kriging
interpolations)<br /> 
</p>
<p><span
style="font-family: cambria, serif; background-color:#ffa; text-align: center;"> (Currently
on UWA LMS, so you will need to be logged in) </span></p>
<p>
 <a href="https://lms.uwa.edu.au/bbcswebdav/pid-3094285-dt-content-rid-40243094_1/xid-40243094_1" target="_blank"> <img
src="./images/pdf.png" alt="pdf file icon" width="32"
height="32" />Annotated R code </a> (2022)<br /> <br />     
<a href="https://lms.uwa.edu.au/bbcswebdav/pid-3094285-dt-content-rid-40243081_1/xid-40243081_1" target="_blank"><img
src="./images/pdf.png" alt="pdf file icon" width="32"
height="32" />Annotated PowerPoint slides</a> (old version, but possibly
still useful for some things)
</p>
</div>
</div>
<p>
 
</p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This guide shows some of the more common and/or easy ways to make
maps in <strong>R</strong> using map-tile-based backgrounds with data
plotted over the base maps. We introduce <em>coordinate reference
systems</em>, <em>recommended packages</em> which allow tile-based map
drawing, a few ways of <em>including user data</em>, and an Appendix on
simple <em>coordinate conversion</em>. <br> The intention is to provide
options to plot informative maps, which include the type of data
collected in this class, relatively simply. We <em>will not</em> cover
vector-based maps, importing GIS shapefiles, interpolation of point
data, chloropleth maps, and many other map plotting methods.</p>
<p><img src="maps_files/figure-html/world%20map%20for%20decoration-1.png" width="45%" style="display: block; margin: auto;" /></p>
<div
style="border: 2px solid gray; background-color:#fff0e0; padding: 8px;">
<p><strong>Notes about maps</strong></p>
<p>[distilled from the author instructions of a few relevant
journals]</p>
<ul>
<li>Include a <span style="color:red;"><strong>scale</strong></span>,
and <span style="color:red;"><strong>north arrow</strong></span> (and
where relevant, <span
style="color:red;"><strong>co-ordinates</strong></span> of latitude (°N,
°S) and longitude (°W, °E);<br /><span
style="color: #6000B0;">grid-based systems such as UTM are also ok, and
can allow scale to be omitted if grid measurements are in
metres).</span></li>
<li>The use of colour unnecessarily is discouraged.</li>
<li>All text must be large enough to be readable. Avoid making the
lettering too large for the figure – this can result in a "cartoonish"
appearance.<br />
</li>
<li>Use a clear, sans serif typeface – the <strong>R</strong> default is
<span style="color:red; font-family:Arial;">Arial</span> (<span
style="color:red; font-family:Helvetica;">Helvetica, </span><span
style="color:red; font-family:&#39;Segoe UI&#39;;">Segoe UI,
</span><span
style="color:red; font-family:&#39;Source Sans Pro&#39;;">Source Sans
Pro, </span><span style="color:red; font-family:ubuntu;">Ubuntu,
<em>etc</em>. are all OK</span>).<br />
</li>
<li>Try to keep all text in a figure (including axis labels, contour
labels, latitude and longitude, scale text, inset text, <em>etc.</em>)
around the same size to aid reducibility and/or enlargement.</li>
<li>Use a white background behind lettering that crosses a dark or
textured area in a figure.</li>
<li>Maps must show locations of any significant places/sample points,
<em>etc</em>., mentioned in your report's text or tables. These might
include cities, rivers, lakes, ponds, drains, landmarks, presumed
sources of contamination, and so on. (These features are not always
present on map tiles.)</li>
<li>A country map is required for all studies, locating the study area.
Adjacent countries must be located and named. [<em>Optional for this
class</em>].</li>
</ul>
</div>
<p>
 
</p>
<div id="load-packages-needed-to-make-maps" class="section level3">
<h3>load packages needed to make maps</h3>
<p>...also read some <em>data</em> we need for map annotations, make
some <em>colour</em> <em>palettes</em> to use later, and set any
alternative Windows <em>fonts</em>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(sf)            <span class="co"># Simple Features spatial data in R</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(maptiles)      <span class="co"># get open-source map tiles for background maps</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(prettymapr)    <span class="co"># add scale bar and north arrows to maps</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(viridis)       <span class="co"># colourblind-friendly colour palettes</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(scico)         <span class="co"># more colourblind-friendly colour palettes</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(ggmap)         <span class="co"># plotting spatial data with ggplot syntax</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>git <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/Ratey-AtUWA/&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>afr_map <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file=</span><span class="fu">paste0</span>(git,<span class="st">&quot;spatial/main/afr_map_v2.csv&quot;</span>), </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>places <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file=</span><span class="fu">paste0</span>(git,<span class="st">&quot;Learn-R/main/places.csv&quot;</span>),</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>                   <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>pal4lite <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, viridis<span class="sc">::</span><span class="fu">plasma</span>(<span class="dv">8</span>), <span class="st">&quot;white&quot;</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>pal4liteTransp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, </span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>                    scico<span class="sc">::</span><span class="fu">scico</span>(<span class="dv">8</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">palette =</span> <span class="st">&quot;hawaii&quot;</span>, <span class="at">beg=</span><span class="fl">0.1</span>),</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>                    <span class="st">&quot;white&quot;</span>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>pal4dark <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, viridis<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">8</span>, <span class="at">beg=</span><span class="fl">0.2</span>, <span class="at">end=</span><span class="fl">0.9</span>,<span class="at">dir=</span><span class="dv">1</span>), <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
</div>
<div id="preparing-to-make-maps" class="section level2">
<h2>Preparing to make maps</h2>
<hr style="height: 2px; background-color: #003087;" />
<blockquote>
<p>"<em>I wisely started with a map</em>."</p>
<p>--- <a href="https://www.tolkienestate.com/painting/maps/"
target="_blank">J. R. R. Tolkien</a></p>
</blockquote>
<hr style="height: 2px; background-color: #003087;" />
<p>First we read the data we need: from <code>.csv</code> files on a
website, into an <strong>R</strong> data frame:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="do">## # afs19 &lt;- read.table(&#39;clipboard&#39;, header=T, sep=&quot;\t&quot;, stringsAsFactors = TRUE)</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co"># alternative code reading data from a file:</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>afs19 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file=</span><span class="fu">paste0</span>(git,<span class="st">&quot;Learn-R/main/afs19.csv&quot;</span>), </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>                  <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>) <span class="co"># use this one</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>afs22 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file=</span><span class="fu">paste0</span>(git,<span class="st">&quot;Learn-R/main/afs22S1.csv&quot;</span>), </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>                  <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Before we start downloading map data, we define and save some
commonly-used coordinate reference systems which describe the map
projection of our GPS data. The function <code>st_crs()</code> is from
the <code>sf</code> package (see explanation below), and as the argument
for the <code>st_crs()</code> function we use the EPSG code for the
desired projection. See <a href="https://epsg.io"
target="_blank">https://epsg.io</a> for more information.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>LongLat <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>) <span class="co"># uses Earth ellipsis specs from WGS84 datum</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>UTM50S <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(<span class="dv">32750</span>) <span class="co"># just for Zone 50, S hemisphere!</span></span></code></pre></div>
<p>We will use these coordinate reference system objects later. For now
we're going to work in UTM coordinates.</p>
<p>Next we'll convert our data frames to <em>Simple Features</em>
spatial data, using the <strong>R</strong> package <code>sf</code>
(Pebesma, 2018). Simple Features is a formal standard (ISO 19125-1:2004)
that describes how objects in the real world can be represented in
computers - see <a
href="https://r-spatial.github.io/sf/articles/sf1.html"
class="uri">https://r-spatial.github.io/sf/articles/sf1.html</a>.</p>
<p>We also make equivalents of these two sf-dataframes in the
longitude--latitude coordinate system, using the
<code>st_transform</code> function.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>afs19utm <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(afs19[<span class="sc">-</span><span class="dv">9</span>,], <span class="co"># omitting row 9 where coordinates are missing</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>                     <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;Easting&quot;</span>,<span class="st">&quot;Northing&quot;</span>),</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>                     <span class="at">crs =</span> UTM50S)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>afs22utm <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(afs22, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;Easting&quot;</span>,<span class="st">&quot;Northing&quot;</span>),</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>                     <span class="at">crs =</span> UTM50S)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>afs19ll <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(afs19utm, <span class="at">crs =</span> LongLat)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>afs22ll <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(afs22utm, <span class="at">crs =</span> LongLat)</span></code></pre></div>
<hr style="height: 2px; background-color: #5560A4;" />
</div>
<div id="alternative-1----maps-in-r-using-the-maptiles-package"
class="section level2">
<h2>Alternative 1 -- Maps in R using the maptiles package</h2>
<div id="defining-the-mapped-area" class="section level3">
<h3>Defining the mapped area</h3>
<p>We define the area we need for our map and save it in a simple
features object called <code>extent</code>.</p>
<p>An easy way to get bounding coordinates (in longitude, latitude) is
by using Google Maps or Google Earth. Google Earth allows the option to
set the coordinate system to UTM. If we generated latitude--longitude
coordinates, we would need to convert our <em>Simple Features</em>
object (see the <strong>Appendix</strong>). If our input coordinates are
Longitude--Latitude, note that south latitudes (and west longitudes) are
negative, and we want decimal degrees rather than
degrees-minutes-seconds. Also note that coordinates from Google Maps and
Google Earth (except in saved <code>.kml</code> files) are in the order
(Latitude, Longitude); <em>i.e</em>. <span
class="math inline">\((y,x)\)</span>, whereas <span
class="math inline">\((x,y)\)</span> (Longitude, Latitude) seems to make
more sense.</p>
<p>For coordinates in the <code>sf</code> and <code>maptiles</code>
packages, <span class="math inline">\(x\)</span> coordinates are
commonly Eastings or Longitudes, and <span
class="math inline">\(y\)</span> coordinates are commonly Northings or
Latitudes.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>extent <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">399900</span>,<span class="dv">400600</span>),<span class="at">y=</span><span class="fu">c</span>(<span class="dv">6467900</span>,<span class="dv">6468400</span>)),</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>                   <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>), <span class="at">crs =</span> UTM50S)</span></code></pre></div>
<p><strong>NOTE</strong>: The projection we specify here will be the one
the map plots in!</p>
</div>
<div id="getting-the-map-tile-data" class="section level3">
<h3>Getting the map tile data</h3>
<p>We now need some functions from the <code>maptiles</code> package
(Giraud 2021). We're using one of the OpenStreetMap tile options, but
the following tile providers also work: <br>
<code>OpenStreetMap, OpenStreetMap.HOT, Esri.WorldStreetMap, Esri.WorldTopoMap, Esri.WorldImagery, Esri.WorldGrayCanvas</code>,
<code>CartoDB.Positron, CartoDB.DarkMatter, CartoDB.Voyager</code> (all
CartoDB... tiles have variants which work), and <code>OpenTopoMap</code>
<br> If you have an account with an API key, you can also use the tiles
from <a href="https://www.thunderforest.com/"
target="_blank">Thunderforest</a> (Thunderforest 'hobby project'
accounts are free). Sadly the Stamen tiles are no longer available.<br>
The option <code>crop = TRUE</code> is included to crop the tiles to our
defined area in the <code>extent</code> object. If we leave it out, the
map may change shape as it will use only square (uncropped) map
tiles.</p>
<p>The map tile style we have selected is the
<code>OpenStreetmap.HOT</code> style, where the suffix <code>HOT</code>
reflects its development by the <a
href="https://www.hotosm.org/updates/2013-09-29_a_new_window_on_openstreetmap_data"
target="_blank">Humanitarian OpenStreetMap Team</a> in France.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: projection of input object e.g. &#39;extent&#39; sets map projection</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>aftiles <span class="ot">&lt;-</span> maptiles<span class="sc">::</span><span class="fu">get_tiles</span>(extent, <span class="at">provider =</span> <span class="st">&quot;OpenStreetMap.HOT&quot;</span>, <span class="at">crop =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="plotting-the-map" class="section level3">
<h3>Plotting the map</h3>
<p>The <code>aftiles</code> object we created is a
<code>SpatRaster</code> object which needs the <code>maptiles</code> (or
<code>terra</code>) package loaded to be able to plot it – see Figure
1.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>aftiles <span class="ot">&lt;-</span> maptiles<span class="sc">::</span><span class="fu">get_tiles</span>(extent, <span class="at">provider =</span> <span class="st">&quot;OpenStreetMap.HOT&quot;</span>, </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>                               <span class="at">crop =</span> <span class="cn">TRUE</span>, <span class="at">zoom=</span><span class="dv">16</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">par</span>(<span class="at">oma=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">lend=</span><span class="st">&quot;square&quot;</span>, <span class="at">xpd=</span><span class="cn">TRUE</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="fu">plot_tiles</span>(aftiles, <span class="at">adjust=</span>F, <span class="at">axes=</span><span class="cn">TRUE</span>, <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co"># points(zk[,2:3], col=&quot;purple&quot;, pch=3, lwd=2)# use axes = TRUE</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;Longitude \u00B0E&quot;</span>, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="fl">3.2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;Latitude \u00B0N&quot;</span>, <span class="at">side =</span> <span class="dv">2</span>, <span class="at">line =</span> <span class="fl">2.3</span>, <span class="at">font=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="maps_files/figure-html/plot-map1-axes-1.png" alt="Figure 1: Map of Ashfield Flats in the UTM projection, generated using the maptiles R package, with OpenStreetMap tiles." width="70%" />
<p class="caption">
Figure 1: Map of Ashfield Flats in the UTM projection, generated using
the maptiles R package, with OpenStreetMap tiles.
</p>
</div>
<p>The next chunk of code adds the <code>prettymapr</code> features
shown in Figure 2. In this code, <code>plotepsg = 32750</code> refers to
the EPSG code for the UTM projection in Zone 50 (EPSG 32750), which we
need to include so that the scale bar shows the correct distances.
(Long-Lat is EPSG 4326 in WGS84)</p>
<p><strong>NOTE</strong>: If the <code>addscalebar</code> function does
not work, run this line of code:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;https://github.com/Ratey-AtUWA/Learn-R/raw/main/scalebar_use_sf_prettymapr.R&quot;</span>)</span></code></pre></div>
<p>(This will replace the function in the <code>prettymapr</code>
package with a modified version that uses the <code>sf</code> package
for coordinate conversions instead of <code>sp</code> and
<code>rgdal</code>.)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># . . . continuing previous code . . .</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">addnortharrow</span>(<span class="at">text.col=</span><span class="dv">1</span>, <span class="at">border=</span><span class="dv">1</span>)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">addscalebar</span>(<span class="at">plotepsg =</span> <span class="dv">32750</span>, <span class="at">label.col =</span> <span class="dv">1</span>, <span class="at">linecol =</span> <span class="dv">1</span>, </span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>            <span class="at">label.cex =</span> <span class="fl">1.2</span>, <span class="at">htin=</span><span class="fl">0.15</span>, <span class="at">widthhint =</span> <span class="fl">0.15</span>)</span></code></pre></div>
<p>
 
</p>
<table border="1" padding="5">
<tr>
<td style="background-color: #e0f0ff;">
<p><strong>Map annotations using maptiles – <em>Hints</em></strong></p>
<p>Plotting in the <code>maptiles</code> package using the
<code>plot_tiles()</code> function (which is actually done by the
<code>plotRGB()</code> from the <code>terra</code> package) tries to set
the plot margins based on the dimensions of the <code>SpatRaster</code>
map object. You may need to adjust your settings; here are some
tips:</p>
<ul>
<li>Set the <code>'base-R'</code> plot margins to zero using
<code>mar=c(0,0,0,0)</code> in the <code>par()</code> function, and set
<code>xpd=TRUE</code> to allow plotting outside the maptiles plot area
(which is often much smaller than you see on screen!).</li>
<li>use the options <code>axes=TRUE, mar=c(3,3,1,1)</code> in the
<code>plot_tiles()</code> function (the actual size of the margins can
be different, but this is where you need to set them)</li>
<li>adjust the height and width of the plot area to best match the
map</li>
<li>you may need to adjust the positions of the map annotations like
axis titles, north arrow, and scale bar.
<ul>
<li>The position of the axis titles is adjusted with the
<code>line=</code> option in the <code>mtext()</code> function.</li>
<li>The positions of the north arrow and scale bar are adjusted with the
<code>padin=</code> option in the <code>addnortharrow()</code> and
<code>addscalebar()</code> functions.</li>
</ul></li>
</ul>
</td>
</tr>
</table>
<div class="figure" style="text-align: center">
<img src="maps_files/figure-html/map-north-scale-1.png" alt="Figure 2: Map of Ashfield Flats (UTM), with added North arrow and scale bar from prettymapr, over OpenStreetMap tiles acquired using maptiles." width="70%" />
<p class="caption">
Figure 2: Map of Ashfield Flats (UTM), with added North arrow and scale
bar from prettymapr, over OpenStreetMap tiles acquired using maptiles.
</p>
</div>
</div>
<div id="adding-our-data-and-map-annotations" class="section level3">
<h3>Adding our data and map annotations</h3>
<p>Very often we would like to <strong>add our own information to a
map</strong>, such as the location of samples, often with different
sizes, shapes, or colours of symbols to represent numerical
information.</p>
<p>Since we have a map in UTM coordinates, we can now add plots of our
data based on UTM locations (with a legend, of course – see Figure 3).
We can plot the points from the non-spatial data frame
<code>afs19</code>, but here we <code>plot</code> the points from
<code>afs19utm</code>, with the <code>add=TRUE</code> option. We add a
legend to the plot in the usual way.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># . . . continuing from previous code . . .</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>clrz <span class="ot">&lt;-</span> <span class="fu">plasma</span>(<span class="dv">15</span>)[<span class="dv">6</span><span class="sc">:</span><span class="dv">15</span>]   <span class="co"># plasma is one of the viridis:: palettes</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">with</span>(afs19utm, <span class="fu">plot</span>(geometry, <span class="at">add=</span><span class="cn">TRUE</span>,  </span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>                    <span class="at">pch =</span> <span class="fu">rep</span>(<span class="dv">21</span><span class="sc">:</span><span class="dv">25</span>,<span class="dv">2</span>)[Group], </span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>                    <span class="at">bg =</span> clrz[Group]))</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend=</span><span class="fu">levels</span>(<span class="fu">as.factor</span>(afs19<span class="sc">$</span>Group)),</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">rep</span>(<span class="dv">21</span><span class="sc">:</span><span class="dv">25</span>,<span class="dv">2</span>), <span class="at">pt.bg =</span> clrz,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Group&quot;</span>, <span class="at">inset =</span> <span class="fl">0.02</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="maps_files/figure-html/add-data-1.png" alt="Figure 3: Map of Ashfield Flats (UTM), with added North arrow, scale bar, and user data, over OpenStreetMap tiles acquired using maptiles." width="70%" />
<p class="caption">
Figure 3: Map of Ashfield Flats (UTM), with added North arrow, scale
bar, and user data, over OpenStreetMap tiles acquired using maptiles.
</p>
</div>
<p>We can also add digitized map features such as wetland ponds, drains,
<em>etc</em>., if these are not on the map tiles already. Ideally we
would add these <strong>before</strong> plotting the data, to avoid the
type of overplotting shown in Figure 4.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># . . . continuing from previous code . . .</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">with</span>(afr_map, <span class="fu">lines</span>(drain_E, drain_N, <span class="at">col =</span> <span class="st">&quot;cadetblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>))</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">with</span>(afr_map, <span class="fu">lines</span>(wetland_E, wetland_N, <span class="at">col =</span> <span class="st">&quot;cadetblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="maps_files/figure-html/map-annot-1.png" alt="Figure 4: Map of Ashfield Flats (UTM), with added North arrow, scale bar, user data, and additional map items, over OpenStreetMap tiles acquired using maptiles." width="70%" />
<p class="caption">
Figure 4: Map of Ashfield Flats (UTM), with added North arrow, scale
bar, user data, and additional map items, over OpenStreetMap tiles
acquired using maptiles.
</p>
</div>
<p>Finally, we would most likely want to add some text. Text labels
should also be added <em>before</em> plotting the data. The final map is
shown in Figure 5.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># . . . continuing from previous code . . .</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">c</span>(<span class="dv">400263</span>, <span class="dv">399962</span>, <span class="dv">400047</span>), <span class="fu">c</span>(<span class="dv">6468174</span>, <span class="dv">6468083</span>, <span class="dv">6468237</span>),</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Chapman Drain&quot;</span>,<span class="st">&quot;Kitchener Drain&quot;</span>, <span class="st">&quot;Woolcock Drain&quot;</span>),</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>     <span class="at">pos =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>), <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">font =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;cadetblue&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="maps_files/figure-html/map-text-labels-1.png" alt="Figure 5: Map of Ashfield Flats (UTM), with added North arrow, scale bar, user data, and additional map items plus text labels, over OpenStreetMap tiles acquired using maptiles." width="70%" />
<p class="caption">
Figure 5: Map of Ashfield Flats (UTM), with added North arrow, scale
bar, user data, and additional map items plus text labels, over
OpenStreetMap tiles acquired using maptiles.
</p>
</div>
</div>
<div id="making-a-bubble-map" class="section level3">
<h3>Making a bubble map</h3>
<p>We use essentially the same code as for the maps above (except
plotting the annotations and data in the correct order!). Then we use
the <code>symbols()</code> function to make the 'bubbles', making sure
that we include the options <code>add = TRUE</code> so we overplot the
map, and <code>inches = FALSE</code> so we can manually scale the
bubbles. The factor <code>s0</code> used to scale the circles in the
code for bubbles and legend is found using a simple algorithm to
estimate a scaling factor from the data). A map like that shown in
Figure 6 is a good exploratory data analysis tool, as even without the
legend it shows any unevenness in concentrations, including where high
concentrations are located.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">oma=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">lend=</span><span class="st">&quot;square&quot;</span>, <span class="at">xpd=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">plot_tiles</span>(aftiles, <span class="at">adjust=</span>F, <span class="at">axes=</span><span class="cn">TRUE</span>, <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>)) <span class="co"># use axes = TRUE</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;Easting (UTM Zone 50, m)&quot;</span>, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="fl">3.2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;Northing (UTM Zone 50, m)&quot;</span>, <span class="at">side =</span> <span class="dv">2</span>, <span class="at">line =</span> <span class="fl">2.3</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="fu">addnortharrow</span>(<span class="at">text.col=</span><span class="dv">1</span>, <span class="at">border=</span><span class="dv">1</span>)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="fu">addscalebar</span>(<span class="at">plotepsg =</span> <span class="dv">32750</span>, <span class="at">label.col =</span> <span class="dv">1</span>, <span class="at">linecol =</span> <span class="dv">1</span>, </span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>            <span class="at">label.cex =</span> <span class="fl">1.2</span>, <span class="at">htin=</span><span class="fl">0.15</span>, <span class="at">widthhint =</span> <span class="fl">0.15</span>)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="fu">with</span>(afr_map, <span class="fu">lines</span>(drain_E, drain_N, <span class="at">col =</span> <span class="st">&quot;cadetblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>))</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="fu">with</span>(afr_map, <span class="fu">polygon</span>(wetland_E, wetland_N, <span class="at">col =</span> <span class="st">&quot;#5F9EA080&quot;</span>, </span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>                    <span class="at">border=</span><span class="st">&quot;cadetblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">1</span>))</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">c</span>(<span class="dv">400225</span>, <span class="dv">400010</span>, <span class="dv">400045</span>), <span class="fu">c</span>(<span class="dv">6468200</span>, <span class="dv">6468130</span>, <span class="dv">6468235</span>),</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Chapman</span><span class="sc">\n</span><span class="st">Drain&quot;</span>,<span class="st">&quot;Kitchener</span><span class="sc">\n</span><span class="st">Drain&quot;</span>,<span class="st">&quot;Woolcock</span><span class="sc">\n</span><span class="st">Drain&quot;</span>),</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>     <span class="at">pos =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>), <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">font =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;cadetblue&quot;</span>)</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co"># plot bubbles using the symbols() function</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>  <span class="co"># first use a simple algoritm to estimate a scale factor for bubbles</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>  axrg <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="st">&quot;usr&quot;</span>)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">par</span>(<span class="st">&quot;usr&quot;</span>)[<span class="dv">1</span>]</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>  bublo <span class="ot">&lt;-</span> <span class="fu">pretty</span>(afs19<span class="sc">$</span>Zn)[<span class="dv">2</span>]</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>  bubhi <span class="ot">&lt;-</span> <span class="fu">pretty</span>(afs19<span class="sc">$</span>Zn)[<span class="fu">length</span>(<span class="fu">pretty</span>(afs19<span class="sc">$</span>Zn))]</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>  s0 <span class="ot">&lt;-</span> <span class="fu">signif</span>(<span class="fl">0.05</span><span class="sc">*</span>axrg<span class="sc">/</span><span class="fu">sqrt</span>(bubhi),<span class="dv">2</span>)</span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a><span class="fu">with</span>(afs19, <span class="fu">symbols</span>(Easting, Northing, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">circles =</span> s0<span class="sc">*</span><span class="fu">sqrt</span>(Zn),</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>                    <span class="at">inches =</span> <span class="cn">FALSE</span>, <span class="at">fg =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">bg =</span> <span class="st">&quot;#8000FF40&quot;</span>))</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a><span class="co"># manual legend</span></span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a>  <span class="co"># first make small legend bubble, checking if it&#39;s zero </span></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">pretty</span>(afs19<span class="sc">$</span>Zn)[<span class="dv">1</span>] <span class="sc">&lt;</span> <span class="fl">0.001</span>) {</span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>    bublo <span class="ot">&lt;-</span> <span class="fu">pretty</span>(afs19<span class="sc">$</span>Zn)[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a>    bublo <span class="ot">&lt;-</span> <span class="fu">pretty</span>(afs19<span class="sc">$</span>Zn)[<span class="dv">1</span>]</span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>  }</span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a><span class="fu">symbols</span>(<span class="fu">c</span>(<span class="dv">400520</span>,<span class="dv">400520</span>),<span class="fu">c</span>(<span class="dv">6468040</span>,<span class="dv">6467980</span>), <span class="at">circles=</span>s0<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">c</span>(bublo,bubhi)), <span class="at">add=</span>T,</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>        <span class="at">lwd=</span><span class="dv">1</span>, <span class="at">inches=</span>F, <span class="at">fg =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">bg =</span> <span class="st">&quot;#8000FF40&quot;</span>)</span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">c</span>(<span class="dv">400520</span>,<span class="dv">400550</span>,<span class="dv">400550</span>),<span class="fu">c</span>(<span class="dv">6468100</span>,<span class="dv">6468040</span>,<span class="dv">6467980</span>), </span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a>     <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Zn (mg/kg)&quot;</span>,bublo,bubhi), <span class="at">cex=</span><span class="fl">0.85</span>, <span class="at">pos =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="maps_files/figure-html/map-bubbles-1.png" alt="Figure 6: Bubble map of zinc concentrations in sediment and soil at Ashfield Flats in 2019, over OpenStreetMap tiles acquired using maptiles." width="70%" />
<p class="caption">
Figure 6: Bubble map of zinc concentrations in sediment and soil at
Ashfield Flats in 2019, over OpenStreetMap tiles acquired using
maptiles.
</p>
</div>
<p>
 
</p>
<p>When reporting on an environmental assessment process such as a <a
href="https://www.nepc.gov.au/sites/default/files/2022-09/schedule-b2-guideline-site-characterisation-sep10.pdf"
target="_blank">Detailed Site Investigation</a>, we should also identify
any samples where environmental guideline values are exceeded. The
additional code below shows how to do this for Zn in sediments; the
relevant guideline values are DGV = 200 mg/kg, DGV-high = 410 mg/kg. The
re-drawn map (Figure 7) shows samples above the 410 mg/kg DGV-high
threshold, and could also be adapted to show concentrations greater than
the DGV, or both.</p>
<p>Note the double plotting of points, first with a thicker line
(<code>lwd=4</code>) to provide a border around the symbols for better
visual contrast.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># ... continuing most of previous code ...</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co"># plot points exceeding guideline value...</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="fu">with</span>(afs19[<span class="fu">which</span>(afs19<span class="sc">$</span>Zn<span class="sc">&gt;=</span><span class="dv">410</span>),], <span class="fu">points</span>(Easting, Northing, <span class="at">pch=</span><span class="dv">3</span>,<span class="at">lwd=</span><span class="dv">4</span>,<span class="at">col=</span><span class="dv">1</span>))</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="fu">with</span>(afs19[<span class="fu">which</span>(afs19<span class="sc">$</span>Zn<span class="sc">&gt;=</span><span class="dv">410</span>),], <span class="fu">points</span>(Easting, Northing, <span class="at">pch=</span><span class="dv">3</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="dv">8</span>))</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co"># ...and make changes to manual legend</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="fu">symbols</span>(<span class="fu">c</span>(<span class="dv">400500</span>,<span class="dv">400500</span>),<span class="fu">c</span>(<span class="dv">6468040</span>,<span class="dv">6467980</span>), <span class="at">circles=</span>s0<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">c</span>(bublo,bubhi)), <span class="at">add=</span>T,</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>        <span class="at">lwd=</span><span class="dv">1</span>, <span class="at">inches=</span>F, <span class="at">fg =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">bg =</span> <span class="st">&quot;#8000FF40&quot;</span>)</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">400500</span>, <span class="dv">6467920</span>, <span class="at">pch=</span><span class="dv">3</span>,<span class="at">lwd=</span><span class="dv">4</span>,<span class="at">col=</span><span class="dv">1</span>)</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">400500</span>, <span class="dv">6467920</span>, <span class="at">pch=</span><span class="dv">3</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="dv">8</span>)</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">c</span>(<span class="dv">400500</span>,<span class="dv">400530</span>,<span class="dv">400530</span>,<span class="dv">400510</span>),<span class="fu">c</span>(<span class="dv">6468100</span>,<span class="dv">6468040</span>,<span class="dv">6467980</span>,<span class="dv">6467920</span>), </span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>     <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Zn (mg/kg)&quot;</span>,bublo,bubhi,<span class="st">&quot;\u2265 DGV-high&quot;</span>), <span class="at">cex=</span><span class="fl">0.85</span>, <span class="at">pos =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="maps_files/figure-html/map-bubbles-DGV-1.png" alt="Figure 7: Bubble map of zinc concentrations in sediment and soil at Ashfield Flats in 2019, over OpenStreetMap tiles acquired using maptiles. Locations where Zn concentration exceeds the DGV-high threshold are shown." width="70%" />
<p class="caption">
Figure 7: Bubble map of zinc concentrations in sediment and soil at
Ashfield Flats in 2019, over OpenStreetMap tiles acquired using
maptiles. Locations where Zn concentration exceeds the DGV-high
threshold are shown.
</p>
</div>
</div>
<div id="categorized-e.g.-percentile-bubble-map" class="section level3">
<h3>Categorized (<em>e.g</em>. percentile) bubble map</h3>
<p>We make a new column in our data frame by <code>cut</code>ting the
measurement of interest, in this example <strong>Zn</strong>, into
percentiles. The new column called <code>QZn</code> is a factor which
identifies which percentile of Zn concentration each sample is in. We
then use this factor to define symbols, sizes, and colours for each
sample location. We add a line break to text labels using <span
class="math inline">\(\backslash\)</span><code>n</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">oma=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">lend=</span><span class="st">&quot;square&quot;</span>, <span class="at">xpd=</span><span class="cn">TRUE</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="fu">plot_tiles</span>(aftiles, <span class="at">adjust=</span>F, <span class="at">axes=</span><span class="cn">TRUE</span>, <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>)) <span class="co"># use axes = TRUE</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;Easting (UTM Zone 50, m)&quot;</span>, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="fl">3.2</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;Northing (UTM Zone 50, m)&quot;</span>, <span class="at">side =</span> <span class="dv">2</span>, <span class="at">line =</span> <span class="fl">2.3</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="fu">addnortharrow</span>(<span class="at">text.col=</span><span class="dv">1</span>, <span class="at">border=</span><span class="dv">1</span>)</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="fu">addscalebar</span>(<span class="at">plotepsg =</span> <span class="dv">32750</span>, <span class="at">label.col =</span> <span class="dv">1</span>, <span class="at">linecol =</span> <span class="dv">1</span>, </span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>            <span class="at">label.cex =</span> <span class="fl">1.2</span>, <span class="at">htin=</span><span class="fl">0.15</span>, <span class="at">widthhint =</span> <span class="fl">0.15</span>)</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="fu">with</span>(afr_map[afr_map<span class="sc">$</span>Drain<span class="sc">!=</span><span class="st">&quot;Chapman_St&quot;</span>,], <span class="fu">lines</span>(drain_E, drain_N, <span class="at">col =</span> <span class="st">&quot;slategray3&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>))</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="fu">with</span>(afr_map, <span class="fu">polygon</span>(wetland_E, wetland_N, <span class="at">col =</span> <span class="st">&quot;#5F9EA080&quot;</span>, </span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>                      <span class="at">border =</span> <span class="st">&quot;cadetblue3&quot;</span>))</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">c</span>(<span class="dv">400225</span>, <span class="dv">399955</span>, <span class="dv">400047</span>), <span class="fu">c</span>(<span class="dv">6468190</span>, <span class="dv">6468083</span>, <span class="dv">6468237</span>),</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Chapman</span><span class="sc">\n</span><span class="st">Drain&quot;</span>,<span class="st">&quot;Kitchener</span><span class="sc">\n</span><span class="st">Drain&quot;</span>, <span class="st">&quot;Woolcock</span><span class="sc">\n</span><span class="st">Drain&quot;</span>),</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>     <span class="at">pos =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>), <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">font =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;cadetblue&quot;</span>)</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co"># percentile plot</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>afs19<span class="sc">$</span>QZn <span class="ot">&lt;-</span> <span class="fu">cut</span>(afs19<span class="sc">$</span>Zn, <span class="fu">quantile</span>(afs19<span class="sc">$</span>Zn, </span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>                 <span class="at">p=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.02</span>,<span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.95</span>,<span class="fl">0.98</span>,<span class="dv">1</span>), </span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>                 <span class="at">na.rm=</span>T), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Q0-02&quot;</span>,<span class="st">&quot;Q02-05&quot;</span>,<span class="st">&quot;Q05-25&quot;</span>,<span class="st">&quot;Q25-50&quot;</span>,</span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>                                    <span class="st">&quot;Q50-75&quot;</span>,<span class="st">&quot;Q75-95&quot;</span>,<span class="st">&quot;Q95-98&quot;</span>,<span class="st">&quot;Q98-max&quot;</span>))</span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="fu">palette</span>(pal4liteTransp) <span class="co"># use colours with semi-transparency (defined near top)</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="co"># use percentile factor column to categorize points</span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="fu">with</span>(afs19, </span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a>     <span class="fu">points</span>(Easting, Northing, </span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a>            <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">22</span>,<span class="dv">22</span>,<span class="dv">22</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">21</span>,<span class="dv">21</span>,<span class="dv">21</span>)[QZn], </span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a>            <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)[QZn], <span class="at">bg =</span> <span class="fu">c</span>(<span class="dv">9</span><span class="sc">:</span><span class="dv">2</span>)[QZn],</span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>)[QZn], </span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a>            <span class="at">cex =</span> <span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.9</span>,<span class="fl">1.1</span>,<span class="fl">1.3</span>,<span class="fl">1.3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)[QZn])</span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a>     )</span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> <span class="fu">levels</span>(afs19<span class="sc">$</span>QZn), <span class="at">title=</span><span class="fu">expression</span>(<span class="fu">bold</span>(<span class="st">&quot;Zn&quot;</span>)),</span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">22</span>,<span class="dv">22</span>,<span class="dv">22</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">21</span>,<span class="dv">21</span>,<span class="dv">21</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb16-32"><a href="#cb16-32" tabindex="-1"></a>       <span class="at">pt.lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">pt.bg =</span> <span class="fu">c</span>(<span class="dv">9</span><span class="sc">:</span><span class="dv">2</span> ), </span>
<span id="cb16-33"><a href="#cb16-33" tabindex="-1"></a>       <span class="at">pt.cex =</span> <span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.9</span>,<span class="fl">1.1</span>,<span class="fl">1.3</span>,<span class="fl">1.3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb16-34"><a href="#cb16-34" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.01</span>), <span class="at">cex =</span> <span class="fl">0.85</span>, <span class="at">y.intersp =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="maps_files/figure-html/PctBubb-1.png" alt="Figure 8: Map showing percentile ranges of zinc concentrations in sediment and soil at Ashfield Flats in 2019, over OpenStreetMap tiles acquired using maptiles." width="70%" />
<p class="caption">
Figure 8: Map showing percentile ranges of zinc concentrations in
sediment and soil at Ashfield Flats in 2019, over OpenStreetMap tiles
acquired using maptiles.
</p>
</div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">palette</span>(pal4lite) <span class="co"># change back to non-transparent palette (optional)</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>afs19<span class="sc">$</span>QZn <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># to delete quantile column (optional; you can leave it in)</span></span></code></pre></div>
<p>The resulting percentile bubble map (Figure 8) adds value to the
'standard' bubble map (Figure 6), as it adds some statistical meaning to
the bubble sizes. A similar map could be created by using the Tukey
boxplot thresholds instead of percentiles which could show potential
outliers (<em>i.e</em>. using the <code>boxplot.stats()</code> function
to generate categories instead of the <code>quantile()</code>
function.)</p>
<p>
 
</p>
<table border="1">
<tr>
<td style="background-color: #FFFF80;">
<span style="font-size: 14pt;"><strong>Warning</strong>:
semi-transparent colours (<em>i.e</em>. alpha &lt; 1) are not supported
by metafiles in R. To use semi-transparent colours, save as
<code>.png</code> or <code>.tiff</code>, or copy as a bitmap.</span>
</td>
</tr>
</table>
<hr style="height: 2px; background-color: #5560A4;" />
</div>
</div>
<div id="alternative-2----maps-in-r-using-the-ggmap-package"
class="section level2">
<h2>Alternative 2 -- Maps in R using the ggmap package</h2>
<p>The <code>ggmap</code> package (Kahle and Wickham 2013) is an
extension of <code>ggplot</code>, so it's easier to use if you are
familiar with <code>ggplot</code> and the associated family of packages.
<span style="color: #A00000;"><em>You will need a Google maps API key
which you can get by registering at <a
href="https://developers.google.com/maps"
target="_blank">https://developers.google.com/maps</a></em></span></p>
<p>First we make a <code>ggmap</code> object, locating the map by its
central coordinate with the extent controlled by the <code>zoom</code>
option:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="do">## library(ggmap)</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">register_google</span>(<span class="at">key =</span> secret[<span class="dv">1</span>,<span class="dv">1</span>]) <span class="co"># you would replace secret[1,1] with your API key</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>udubua.gg <span class="ot">&lt;-</span> <span class="fu">get_googlemap</span>(<span class="at">center=</span><span class="fu">c</span>(<span class="fl">115.8213</span>,<span class="sc">-</span><span class="fl">31.98165</span>), </span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>                           <span class="at">zoom =</span> <span class="dv">16</span>, <span class="at">maptype =</span> <span class="st">&quot;roadmap&quot;</span>, <span class="at">color =</span> <span class="st">&quot;bw&quot;</span>)</span></code></pre></div>
<p>This always gives a <strong>square</strong> map (Figure 9) – which we
might not always want. In theory, the map aspect ratio can be changed
using the <code>size</code> argument in the <code>get_googlemap</code>
function, but this does not work reliably. We recommend leaving the map
dimensions and aspect ratio at their default values.</p>
<p>Next we plot the ggmap object using ggplot grammar. It's possible to
just plot the object (<em>i.e</em>. run <code>ggmap(udubua.gg)</code>),
but it's good to have more control over plot options
<strong>and</strong> to plot some data over the base map. In the example
in Figure 9, we use the aesthetic in <code>geom_point()</code> to plot
different categories with different shapes and colours, with the
categories defined by the factor <code>Type</code>. A range of map
styles is available by selecting a combination of one of
<code>maptype = "terrain", "satellite", "roadmap"</code>, or
<code>"hybrid"</code>, together with <code>color = "color"</code> or
<code>"bw"</code>. <strong>Note</strong>: the <code>ggsm</code> package
is designed to add scale bar and north arrow to ggmaps, but it seems
buggy and we currently don't recommend it - the north arrow seems OK
though.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">ggmap</span>(udubua.gg) <span class="sc">+</span> </span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Latitude (\u00B0S)&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Longitude (\u00B0E)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">115.825</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">31.98</span>, <span class="at">label =</span> <span class="st">&quot;Swan</span><span class="sc">\n</span><span class="st">River&quot;</span>,</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>                <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">family=</span><span class="st">&quot;sans&quot;</span>), </span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">4</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">&quot;gray40&quot;</span>) <span class="sc">+</span> </span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">col=</span>Type, <span class="at">shape=</span>Type), </span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>             <span class="at">data =</span> places, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>),</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="maps_files/figure-html/ggmap1-1.png" alt="Figure 9: Map of the University of Western Australia campus at Crawley, showing the location of libraries and cafés, plotted over Google maps tiles acquired using the R package ggmap." width="75%" />
<p class="caption">
Figure 9: Map of the University of Western Australia campus at Crawley,
showing the location of libraries and cafés, plotted over Google maps
tiles acquired using the R package ggmap.
</p>
</div>
<p>There are numerous possibilities with <code>ggmap</code> and the
features made possible by <code>ggplot2</code> that are not illustrated
by Figure 9. For example, we could use <code>size</code> as an aesthetic
(<em>i.e</em>. include within <code>aes(...)</code> with
<code>size = variableName</code>), to generate something like a bubble
map.</p>
<div id="other-map-types-using-ggmap" class="section level3">
<h3>Other map types using ggmap</h3>
<p>Another option apparently available in <code>ggmap</code> are some of
the <em>Stamen</em> map tiles, accessible with the
<code>get_stamenmap()</code> function. <strong>However</strong>, the
Stamen URLs have been updated, and this function is no longer able to
download Stamen map tiles.</p>
<p><span style="size: 14pt"><strong>The next example</strong></span>
(Figure 10) uses the simple features information in one of the data
frames we made at the beginning. The <code>sf</code> package introduces
a new 'geom', <code>geom_sf()</code> for plotting in <code>ggmap.</code>
We need to use the option <code>inherit.aes = FALSE</code> in
<code>geom_sf()</code>, to override the default aesthetics from the
<code>ggmap</code> object. We also add <code>coord_sf</code> to ensure
that all layers use a common CRS (<u>C</u>oordinate <u>R</u>eference
<u>S</u>ystem). <br> Run <code>help(geom_sf)</code> for more
information.</p>
<p>Plotting using <code>geom_sf()</code> when the CRS is in degrees
adds, by default, a °S/°W/°N/°E suffix to the axis values. In the code
below we suppress this using <code>scale_x_continuous(label = I)</code>
(same for the y axis; the <code>limits</code> and <code>expand</code>
options stop the manual scale adding space around the map tiles). We
include the information on units and hemisphere in the axis titles.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>afr.gg <span class="ot">&lt;-</span> <span class="fu">get_googlemap</span>(<span class="at">center=</span><span class="fu">c</span>(<span class="at">lon=</span><span class="fl">115.9445</span>, <span class="at">lat =</span> <span class="sc">-</span><span class="fl">31.918</span>), </span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>                        <span class="at">zoom=</span><span class="dv">17</span>, <span class="at">col =</span> <span class="st">&quot;bw&quot;</span>, <span class="at">maptype =</span> <span class="st">&quot;terrain&quot;</span>)</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">as.vector</span>(<span class="fu">attr</span>(afr.gg, <span class="st">&quot;bb&quot;</span>))))</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="fu">ggmap</span>(afr.gg) <span class="sc">+</span> </span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Latitude (\u00B0S)&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Longitude (\u00B0E)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">115.944</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">31.918</span>, <span class="at">label =</span> <span class="st">&quot;Ashfield</span><span class="sc">\n</span><span class="st">Flats&quot;</span>,</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>                <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">family=</span><span class="st">&quot;sans&quot;</span>), </span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color=</span><span class="st">&quot;gray65&quot;</span>, <span class="at">lineheight=</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">115.942</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">31.9199</span>, <span class="at">label =</span> <span class="st">&quot;Swan River&quot;</span>,</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>                <span class="at">fontface=</span><span class="st">&quot;italic&quot;</span>, <span class="at">family=</span><span class="st">&quot;sans&quot;</span>), <span class="at">size=</span><span class="dv">4</span>, <span class="at">color=</span><span class="st">&quot;gray65&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x =</span> drain_lon, <span class="at">y=</span>drain_lat), <span class="at">data=</span>afr_map, </span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;slategray2&quot;</span>, <span class="at">size =</span> <span class="fl">1.25</span>) <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">x=</span>wetland_lon, <span class="at">y=</span>wetland_lat), <span class="at">data =</span> afr_map,</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">&quot;slategray&quot;</span>, <span class="at">fill=</span><span class="st">&quot;azure3&quot;</span>) <span class="sc">+</span> </span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> afs21ll, <span class="fu">aes</span>(<span class="at">bg=</span>Zn, <span class="at">size=</span>Zn), <span class="at">shape=</span><span class="dv">21</span>, <span class="at">inherit.aes=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> I, <span class="at">limits=</span><span class="fu">c</span>(bb[<span class="dv">2</span>],bb[<span class="dv">4</span>]), </span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> I, <span class="at">limits=</span><span class="fu">c</span>(bb[<span class="dv">1</span>],bb[<span class="dv">3</span>]), </span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a>  <span class="fu">scale_size_area</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">100</span>,<span class="dv">300</span>,<span class="dv">1000</span>,<span class="dv">3000</span>,<span class="dv">5000</span>), <span class="at">max_size =</span> <span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>),</span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span></span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="maps_files/figure-html/ggAF-1.png" alt="Figure 10: Zinc concentration (mg/kg) in sediment sampled in Semester 1, 2021 at Ashfield Flats, Western Australia, plotted over greyscale Google terrain map tiles acquired using the R package ggmap, with data in a simple features data frame, and with manually added wetland pond locations." width="70%" />
<p class="caption">
Figure 10: Zinc concentration (mg/kg) in sediment sampled in Semester 1,
2021 at Ashfield Flats, Western Australia, plotted over greyscale Google
terrain map tiles acquired using the R package ggmap, with data in a
simple features data frame, and with manually added wetland pond
locations.
</p>
</div>
<hr style="height: 2px; background-color: #5560A4;" />
</div>
</div>
<div id="other-tile-based-mapping-packages-in-r" class="section level2">
<h2>Other tile-based mapping packages in R</h2>
<p>The <code>rosm</code> package (Dunnington 2022) allows users to
produce background maps from several map tile providers. <strong>We
don't currently recommend</strong> <code>rosm</code>, since it's
difficult when using this package to produce axes in commonly-used
coordinate reference systems.</p>
<p>The <code>OpenStreetMap</code> R package (Fellows, 2019) can make
very good tile-based maps. Unfortunately, however, it can be difficult
to use on Apple Mac computers, and there can also be problems with
Windows-based systems due to the use of <code>Java</code> code in the
package. So, out of respect for MacOS users, we are <strong>not
recommending the</strong> <code>OpenStreetMap</code> package either.</p>
</div>
<div id="final-words" class="section level2">
<h2>Final Words</h2>
<p>We recommend using either the <code>maptiles</code> or
<code>ggmap</code> packages to draw maps with tiled backgrounds, as they
allow use of the state-of-the-art <em>simple features</em> system
<em>via</em> the <code>sf</code> package.</p>
<p>
 
</p>
<center>
<img src="./images/RubberDucks.png" /><br> <a
href="https://www.iflscience.com/28000-rubber-ducks-accidentally-embarked-on-an-epic-ocean-current-study-in-1992-58342"
target="_blank">read about it</a>
</center>
<p>
 
</p>
</div>
<div id="appendix---coordinate-conversions" class="section level2">
<h2>Appendix - coordinate conversions</h2>
<p><strong>Converting UTM to LongLat</strong></p>
<p>Make a simple features (package <code>sf</code>) object containing
the UTM coordinates</p>
<p>Example uses explicit values (as used previously to generate the
<code>maptiles</code> map), but the coordinates could also be obtained
from a data frame - edit to suit!</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>utm.temp <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">399800</span>,<span class="dv">400700</span>),<span class="at">y=</span><span class="fu">c</span>(<span class="dv">6467900</span>,<span class="dv">6468400</span>)),</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>                     <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>), <span class="at">crs =</span> UTM50S)</span></code></pre></div>
<p>We then use the <code>st_transform()</code> function from the
<code>sf</code> package to convert to long-lat (or another projection),
which results in another spatial object:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>longlat.temp <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(utm.temp, <span class="at">crs =</span> LongLat)</span></code></pre></div>
<p>We now have two <code>sf</code> spatial objects which we can use (for
instance) to define the map extent for a <code>maptiles</code> map:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">require</span>(sf); <span class="fu">require</span>(maptiles) <span class="co"># load packages if not done already</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="co"># using the utm object</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>tiles_utm <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(utm.temp, <span class="at">provider =</span> <span class="st">&quot;OpenStreetMap&quot;</span>, <span class="at">crop =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co"># using the longitude-latitude object</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>tiles_longlat <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(longlat.temp, <span class="at">provider =</span> <span class="st">&quot;OpenStreetMap&quot;</span>,</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>                          <span class="at">crop =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="co"># . . . and so on</span></span></code></pre></div>
<p>To extract coordinates from a data frame, for example: <br>
(<strong>NOTE</strong> - missing coordinates are not allowed!)</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>afs19 <span class="ot">&lt;-</span> afs19[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">is.na</span>(afs19[,<span class="fu">c</span>(<span class="st">&quot;Easting&quot;</span>)])<span class="sc">==</span><span class="dv">1</span>),] <span class="co"># remove rows with NAs</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>afs19utm <span class="ot">&lt;-</span>  <span class="fu">st_as_sf</span>(afs19, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;Easting&quot;</span>,<span class="st">&quot;Northing&quot;</span>), <span class="at">crs =</span> UTM50S)</span></code></pre></div>
<p>We then use the <code>st_transform()</code> function from the
<code>sf</code> package to convert to longitude-latitude, which results
in another spatial data frame:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>afs19ll <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(afs19utm, <span class="at">crs =</span> LongLat)</span></code></pre></div>
<p>To extract just the coordinate values in non-spatial form, we use the
function <code>st_coordinates()</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># extract sf coordinates to console (can assign to object of class &quot;matrix&quot;)</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="fu">st_coordinates</span>(afs19utm)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co"># extract sf coordinates to data frame</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>longlat.temp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">st_coordinates</span>(afs19ll))</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="fu">colnames</span>(longlat.temp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Longitude&quot;</span>,<span class="st">&quot;Latitude&quot;</span>)</span></code></pre></div>
<hr style="height: 2px; background-color: #5560A4;" />
</div>
<div id="references-and-r-packages" class="section level2">
<h2>References and R packages</h2>
<p>Dunnington, Dewey (2017). <em>prettymapr: Scale Bar, North Arrow, and
Pretty Margins in R</em>. R package version 0.2.2. <a
href="https://CRAN.R-project.org/package=prettymapr"
target="_blank">https://CRAN.R-project.org/package=prettymapr</a>.</p>
<p>Dunnington D (2022). <em>rosm: Plot Raster Map Tiles from Open Street
Map and</em> <em>Other Sources</em>. R package version 0.2.6, <a
href="https://CRAN.R-project.org/package=rosm"
target="_blank">https://CRAN.R-project.org/package=rosm</a>.</p>
<p>Fellows, Ian and using the JMapViewer library by Jan Peter Stotz
(2019). <em>OpenStreetMap: Access to Open Street Map Raster Images</em>.
R package version 0.3.4. <a
href="https://CRAN.R-project.org/package=OpenStreetMap"
target="_blank">https://CRAN.R-project.org/package=OpenStreetMap</a>.</p>
<p>Giraud T (2021). <em>maptiles: Download and Display Map Tiles</em>. R
package version 0.3.0, <a
href="https://CRAN.R-project.org/package=maptiles"
target="_blank">https://CRAN.R-project.org/package=maptiles</a>.</p>
<p>Garnier S, Ross N, Rudis R, Camargo AP, Sciaini M, Scherer C (2021).
<em>Rvision - Colorblind-Friendly Color Maps for R</em>. R package
version 0.6.2. (<strong>viridis</strong>)</p>
<p>D. Kahle and H. Wickham. <code>ggmap</code>: Spatial Visualization
with <code>ggplot2</code>. <em>The R Journal</em>,
<strong>5</strong>(1), 144-161. <a
href="http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf"
target="_blank">http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf</a>.</p>
<p>Pebesma, E., 2018. Simple Features for R: Standardized Support for
Spatial VectorData. <em>The R Journal</em> <strong>10</strong> (1),
439-446, <a href="https://doi.org/10.32614/RJ-2018-009"
target="_blank">https://doi.org/10.32614/RJ-2018-009</a> . (package
<code>sf</code>)</p>
<p>Pebesma, E.J., R.S. Bivand, 2005. Classes and methods for spatial
data in R. <em>R News</em> <strong>5</strong> (2), <a
href="https://cran.r-project.org/doc/Rnews/"
target="_blank">https://cran.r-project.org/doc/Rnews/</a>. (package
<code>sp</code>)</p>
<hr style="height: 2px; background-color: #5560A4;" />
<p style="text-align:center;">
<img src="./images/Lemi.png" />
</p>
</div>
</div>

<!DOCTYPE html>

<html>
<body>
<hr style="height: 2px; background-color: #003087;" />
<p><span style="font-size:10pt"><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank"><strong>CC-BY-SA</strong></a> • All content by <a href="https://github.com/Ratey-AtUWA" target="_blank">Ratey-AtUWA</a>. My <a href="https://www.uwa.edu.au/schools/agriculture-and-environment" target="_blank">employer</a> does not necessarily know about or endorse the content of this website.</span><br>
<span style="font-size:9pt">Created with <a href="https://bookdown.org/yihui/rmarkdown/" target="_blank"><span style="font-family: monospace;">rmarkdown</span></a> in <a href="https://posit.co/download/rstudio-desktop/" target="_blank"><span class="fa fa-registered"></span> RStudio</a>.</span></p>
</body>
</html>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
