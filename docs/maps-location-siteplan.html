<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Andrew Rate" />

<meta name="date" content="2024-12-12" />

<title>Locality and Site Plan maps in R</title>

<script src="site_libs/header-attrs-2.27/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Sessions</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="about.html">For beginners</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Intro

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="intro.html">Intro</a>
    </li>
    <li>
      <a href="intro-GG.html">Intro+ggplot</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Plots

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="plots.html">Plots-baseR</a>
    </li>
    <li>
      <a href="plots-GG.html">Plots-ggplot</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Compare

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="means.html">Compare means (parametric)</a>
    </li>
    <li>
      <a href="nonparam.html">Non-parametric comparisons</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Relate

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="correl.html">Correlation</a>
    </li>
    <li>
      <a href="regression.html">Simple linear regression</a>
    </li>
    <li>
      <a href="reg-group.html">Grouped linear regression</a>
    </li>
    <li>
      <a href="reg-multi.html">Multiple linear regression</a>
    </li>
    <li>
      <a href="timeseries.html">Time series analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Maps

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="maps.html">Map data with tile backgrounds</a>
    </li>
    <li>
      <a href="spatial.html">Spatial statistics</a>
    </li>
    <li>
      <a href="spat-interp.html">Spatial interpolation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Multi

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pca.html">Principal components analysis</a>
    </li>
    <li>
      <a href="vegan.html">Analysis of species presence-absence data</a>
    </li>
    <li>
      <a href="lda.html">Linear discriminant analysis</a>
    </li>
    <li>
      <a href="cluster.html">Cluster analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Util

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="distributions.html">Distribution checking</a>
    </li>
    <li>
      <a href="residuals.html">Regression residuals to identify contamination</a>
    </li>
    <li>
      <a href="hydrus1d.html">Hydrus-1D cheatsheet</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Reporting

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="report-resources.html">Resources for reporting</a>
    </li>
    <li>
      <a href="tablesPlus.html">Tables &amp; trigger value counts</a>
    </li>
    <li>
      <a href="maps-location-siteplan.html">Locality and Site Plan maps</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://www.uwa.edu.au/schools/agriculture-and-environment">School of Agriculture and Environment</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<!DOCTYPE html>

<html>
<body>
<h3><img src="./images/2015-UWA-Full-Hor-CMYK.png" alt="UWA logo" align="right"><span style="color:#003087;">Material to support teaching in Environmental Science at The University of Western Australia</span></h3>
<h4><span style="color:#93721A;">Units ENVT3361, ENVT4461, and ENVT5503</span></h4></p>
</body>
</html>

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Locality and Site Plan maps in R</h1>
<h3 class="subtitle">Maps for Environmental reporting</h3>
<h4 class="author">Andrew Rate</h4>
<h4 class="date">2024-12-12</h4>

</div>


<style type="text/css">
  body{
  font-size: 12pt;
}
</style>
<div style="border: 2px solid #039; padding: 8px;">
<p style="text-align:center; font-size:12pt;">
<em>Maps / spatial pages</em>: <a href="maps.html"
style="color:#04b;">Maps</a> | <a href="spatial.html"
style="color:#04b;">Spatial statistics</a> | <a href="spat-interp.html"
style="color:#04b;">Spatial interpolation</a>
</p>
</div>
<p> </p>
<div
style="border: 2px solid #039; background-color:#fec; padding: 8px;">
<p style="text-align:center; font-size:12pt;">
<strong>UWA Students</strong>: <a href="#TandL">Go here for Learning
Objectives and suggested activities on this page</a>
</p>
</div>
<p> </p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>We prepare maps for environmental reporting for two main reasons:</p>
<ol style="list-style-type: decimal">
<li><p>To show the site being investigated in its context, such as site
boundaries, surrounding land use, potential broader sources of
contamination, proximity to receiving environments, and so on. This is
called a “<em>Locality Map</em>”.</p></li>
<li><p>To show the relevant details of the site being investigated:
relevant infrastructure, specific suspected sources of contamination,
sample types and locations, samples with contaminant conentrations
exceeding guideline values, <em>etc</em>. This is called a “<em>Site
Plan map</em>”.</p></li>
</ol>
<p>This page presents a simple workflow to prepare both Locality and
Site Plan maps using relevant packages in R.</p>
<div
id="load-the-r-packages-we-need-for-plotting-maps-install-first-if-needed"
class="section level3">
<h3>Load the R packages we need for plotting maps (install first if
needed)</h3>
<p>Install the required packages to your device if you don't have them
already (<strong>only do this once</strong>, not every R session):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(sf)) <span class="fu">install.packages</span>(<span class="st">&quot;sf&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(maptiles)) <span class="fu">install.packages</span>(<span class="st">&quot;maptiles&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(prettymapr)) <span class="fu">install.packages</span>(<span class="st">&quot;prettymapr&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(TeachingDemos)) <span class="fu">install.packages</span>(<span class="st">&quot;TeachingDemos&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(viridis)) <span class="fu">install.packages</span>(<span class="st">&quot;viridis&quot;</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(ggmap)) <span class="fu">install.packages</span>(<span class="st">&quot;ggmap&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(ggplot2)) <span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(ggspatial)) <span class="fu">install.packages</span>(<span class="st">&quot;ggspatial&quot;</span>)</span></code></pre></div>
<p>You will need to load the installed packages each time you start
RStudio.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(sf)            <span class="co"># essential for maps and spatial analysis in R</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">library</span>(maptiles)      <span class="co"># for downloading map tile images</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">library</span>(prettymapr)    <span class="co"># for making north arrow and scale bar</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">library</span>(TeachingDemos) <span class="co"># for shadowtext() function (outlined text)</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">library</span>(viridis)       <span class="co"># for accessible colour palettes</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="fu">palette</span>(<span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="fu">viridis</span>(<span class="dv">8</span>), <span class="st">&quot;royalblue&quot;</span>, </span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>          <span class="st">&quot;white&quot;</span>, <span class="st">&quot;transparent&quot;</span>, <span class="st">&quot;firebrick&quot;</span>, <span class="st">&quot;grey44&quot;</span>)) <span class="co"># custom colours</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span></code></pre></div>
</div>
<div id="read-some-external-data-for-adding-info-to-maps"
class="section level3">
<h3>Read some external data for adding info to maps</h3>
<p>This code uses some functions from the <code>sf</code> R package(
)Pebesma, 2018) to import some data from <code>.kml</code> files (Google
Earth format), and transform the resulting spatial <code>sf</code>
objects to the projection we are using. For more detail on the
<code>sf</code> package, map projections, <em>etc</em>., look at <a
href="maps.html" style="color:#04b;">the Introduction to Maps in R
page</a>.</p>
<p>The <code>st_read()</code> function can import data from numerous
formats such as ESRI shapefiles and Google Earth <code>.kml</code>
files. The <code>st_transform</code> function converts the
longitude-latitude coordinates in the <code>.kml</code> files (units of
degrees) to the coordinate reference system (CRS) specified by the
function <code>st_crs()</code> called within <code>st_transform</code>.
The CRS is specified by the <a href="https://epsg.io/"
target="_blank">EPSG code</a>, where <code>32750</code> indicates UTM
Zone 50 S based on the WGS84 datum, with units of metres.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>git <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/Ratey-AtUWA/Learn-R-web/raw/refs/heads/main/&quot;</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>LC_site <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(git, <span class="st">&quot;LC_UWA_study_area.kml&quot;</span>))</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>LC_site <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(LC_site, <span class="at">crs=</span><span class="fu">st_crs</span>(<span class="dv">32750</span>)) <span class="co"># convert to UTM Zone 50S</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>Claremont_drains <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(git, <span class="st">&quot;Town-of-Claremont-Drains.kml&quot;</span>))</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>(Claremont_drains <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(Claremont_drains, </span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>                                 <span class="at">crs=</span><span class="fu">st_crs</span>(<span class="dv">32750</span>))) <span class="co"># convert to UTM Zone 50S</span></span></code></pre></div>
<p> </p>
</div>
</div>
<div id="locality-map" class="section level1">
<h1>LOCALITY MAP</h1>
<p>Australian guidelines for reporting on contaminated site
investigations (NEPC 2011, DWER 2021) specify including a locality map
"...showing site location, site boundary, cadastral boundary or
boundaries, surrounding area and any key nearby features..." (DWER,
2021).</p>
<p>The first part of this code shows a method for producing a locality
map in R, relying on the <code>sf</code> spatial R package (Pebesma and
Bivand, 2023) together with the packages <code>maptiles</code> (Giraud,
2024) and <code>prettymapr</code> (Dunnington, 2024).</p>
<div id="next-define-a-rectangle-for-a-locality-map"
class="section level3">
<h3>next define a rectangle for a locality map</h3>
<p>Find coordinates by:</p>
<ul>
<li>locating the bottom-left and top-right corners of the desired
rectangle using the maps at the EPSG site (<a href="https://epsg.io/map"
target="_blank">https://epsg.io/map</a> – make sure the Coordinate
system at the bottom is changed to EPSG:32750).</li>
<li>using Google Earth with ⊙ Universal Transverse Mercator selected
under <code>Show Lat/Long</code> after clicking Tools/Options... , then
Add Placemark 📌</li>
</ul>
<p> </p>
<p><strong>⚠ THESE COORDINATES 👇 ARE NOT REAL! - PLEASE FIND YOUR
OWN!</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>locality <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">123456</span>,<span class="dv">123456</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="dv">1234567</span>,<span class="dv">1234567</span>)),</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>                     <span class="at">coords=</span><span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>), <span class="at">crs=</span>st_ <span class="fu">evalcrs</span>(<span class="dv">32750</span>))</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>locality <span class="co"># check it worked: should include &#39;Projected CRS: WGS 84 / UTM zone 50S&#39;</span></span></code></pre></div>
<p> </p>
</div>
<div id="use-the-get_tiles-function-with-options-to-download-map-tiles"
class="section level3">
<h3>Use the <code>get_tiles()</code> function with options to download
map tiles</h3>
<p>The code above made an object <code>locality</code> which defined our
map rectangle in our chosen coordinate system. The <code>locality</code>
object then becomes an input for the <code>get_tiles()</code> function
from the <code>maptiles</code> R package. We specify some other options
as well: <code>provider=</code> sets the map tile style, and
<code>zoom=</code> sets the level of detail. At each zoom level, map
tiles are squares, so we use <code>crop=TRUE</code> to trim any unneeded
parts of the map tile images.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="do">## claremontMap &lt;- get_tiles(locality, provider=&quot;OpenStreetMap&quot;, crop=TRUE,</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="do">##                           zoom=15)</span></span></code></pre></div>
<p> </p>
</div>
<div id="then-plot-the-map" class="section level3">
<h3>Then plot the map</h3>
<p>The best option for plotting seems to be to:</p>
<ol style="list-style-type: decimal">
<li><p>Plot an empty map frame based on the extent object
(<code>locality</code>), adding axis labels and specifying
<code>xaxs="i", yaxs="i"</code> to suppress axis padding.</p></li>
<li><p>Use the <code>plot_tiles()</code> function from the
<code>maptiles</code> R package to add the map tile layer. We include
the option <code>add=TRUE</code> to plot on top of the previous
plot.</p></li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># first setting graphics parameters with par()</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mgp=</span><span class="fu">c</span>(<span class="fl">1.5</span>,<span class="fl">0.3</span>,<span class="dv">0</span>), <span class="at">font.lab=</span><span class="dv">2</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co"># first an empty plot frame based on the map extent</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_coordinates</span>(locality), <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">xaxs=</span><span class="st">&quot;i&quot;</span>, <span class="at">yaxs=</span><span class="st">&quot;i&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Easting&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Northing&quot;</span>)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">plot_tiles</span>(claremontMap, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="fu">box</span>() <span class="co"># redraw plot frame</span></span></code></pre></div>
<div class="figure">
<img src="maps-location-siteplan_files/figure-html/plot-base-locality-map-1.png" alt="Figure 1: Georeferenced map tile image obtained with the `maptiles` R package to use as a base locality map." width="787.2" />
<p class="caption">
Figure 1: Georeferenced map tile image obtained with the
<code>maptiles</code> R package to use as a base locality map.
</p>
</div>
<p> </p>
<p>After plotting the map in RStudio, you will probably need to adjust
the size and proportions of your plot area manually, so that the map
tiles fill the whole plot frame.</p>
</div>
<div id="next-add-the-necessary-map-and-plot-features-and-annotations"
class="section level3">
<h3>Next, add the necessary map and plot features and annotations</h3>
<p>The guidelines state that a North arrow and scale bar should be
included on maps, as well as the locations of significant geographical
features (natural <em>or</em> anthropogenic).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># ...continuing code from above</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">addnortharrow</span>()</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">addscalebar</span>(<span class="at">plotepsg =</span> <span class="dv">32750</span>, <span class="at">pos=</span><span class="st">&quot;bottomleft&quot;</span>, <span class="at">label.col =</span> <span class="dv">1</span>, <span class="at">linecol =</span> <span class="dv">1</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>            <span class="at">label.cex =</span> <span class="fl">1.2</span>, <span class="at">htin=</span><span class="fl">0.15</span>, <span class="at">widthhint=</span><span class="fl">0.3</span>, <span class="at">padin=</span><span class="fu">c</span>(<span class="fl">0.15</span>,<span class="fl">0.25</span>))</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;CRS:UTM Zone 50S, WGS84 (EPSG:32750)&quot;</span>, <span class="at">side=</span><span class="dv">1</span>, <span class="at">line=</span><span class="sc">-</span><span class="fl">1.2</span>, </span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>      <span class="at">font=</span><span class="dv">2</span>, <span class="at">col=</span><span class="dv">14</span>, <span class="at">cex=</span><span class="fl">0.75</span>, <span class="at">adj=</span><span class="fl">0.02</span>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="fu">shadowtext</span>(<span class="dv">384350</span>,<span class="dv">6461820</span>, <span class="at">labels=</span><span class="st">&quot;Lake</span><span class="sc">\n</span><span class="st">Claremont&quot;</span>, <span class="at">col=</span><span class="dv">3</span>, <span class="at">bg=</span><span class="dv">11</span>, <span class="at">cex=</span><span class="fl">0.85</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="fu">shadowtext</span>(<span class="dv">385000</span>,<span class="dv">6461120</span>, <span class="at">labels=</span><span class="st">&quot;Fremantle Railway&quot;</span>, <span class="at">col=</span><span class="dv">5</span>, <span class="at">bg=</span><span class="dv">11</span>, <span class="at">cex=</span><span class="fl">0.85</span>, <span class="at">srt=</span><span class="dv">25</span>)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="fu">shadowtext</span>(<span class="dv">382900</span>, <span class="dv">6462250</span>, <span class="at">labels=</span><span class="st">&quot;Military</span><span class="sc">\n</span><span class="st">Facility&quot;</span>, <span class="at">col=</span><span class="dv">5</span>, <span class="at">bg=</span><span class="dv">11</span>, <span class="at">cex=</span><span class="fl">0.85</span>)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="fu">shadowtext</span>(<span class="dv">382100</span>, <span class="dv">6462200</span>, <span class="at">labels=</span><span class="st">&quot;Indian Ocean&quot;</span>, <span class="at">col=</span><span class="dv">3</span>, <span class="at">bg=</span><span class="dv">11</span>, <span class="at">font=</span><span class="dv">3</span>, <span class="at">srt=</span><span class="dv">90</span>, <span class="at">cex=</span><span class="fl">0.85</span>)</span></code></pre></div>
<div class="figure">
<img src="maps-location-siteplan_files/figure-html/add-map-annot-1.png" alt="Figure 2: Georeferenced map tile image obtained with `maptiles`, with `prettymapr` north arrow and scale bar, and text annotations using the `shadowtext()` funtion from the `TeachingDemos` package." width="787.2" />
<p class="caption">
Figure 2: Georeferenced map tile image obtained with
<code>maptiles</code>, with <code>prettymapr</code> north arrow and
scale bar, and text annotations using the <code>shadowtext()</code>
funtion from the <code>TeachingDemos</code> package.
</p>
</div>
<p> </p>
</div>
<div id="finally-add-the-data-we-imported-earlier-and-a-legend"
class="section level3">
<h3>Finally add the data we imported earlier, and a legend</h3>
<p>We should always indicate the location of the site under
investigation on our Locality Map. We also include stormwater drains on
this map, since stormwater may affect water quality in Lake Claremont.
Adding a legend helps readers with map interpretation.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># ...continuing code from above</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">plot</span>(Claremont_drains[<span class="dv">1</span>], <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="dv">10</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="fu">plot</span>(LC_site[<span class="dv">1</span>], <span class="at">add=</span>T, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="dv">13</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">bg=</span><span class="st">&quot;#ffffffa0&quot;</span>, <span class="at">box.col=</span><span class="dv">12</span>, <span class="at">inset=</span><span class="fl">0.02</span>,</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Lake Claremont study site&quot;</span>,</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>                <span class="st">&quot;Town of Claremont stormwater drains&quot;</span>),</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>       <span class="at">lwd=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="dv">13</span>,<span class="dv">10</span>))</span></code></pre></div>
<div class="figure">
<img src="maps-location-siteplan_files/figure-html/final-locality-map-1.png" alt="Figure 3: Georeferenced map tile image obtained with `maptiles`, with annotations as in Figure 2, and third-party data used to plot stormwater drain locations and show the extent of the study area." width="787.2" />
<p class="caption">
Figure 3: Georeferenced map tile image obtained with
<code>maptiles</code>, with annotations as in Figure 2, and third-party
data used to plot stormwater drain locations and show the extent of the
study area.
</p>
</div>
<p> </p>
</div>
<div id="alternative-plotting-using-ggmapggplot2"
class="section level2">
<h2>Alternative: plotting using
<code>ggmap</code>/<code>ggplot2</code></h2>
<p>The <code>ggplot2</code> R package is a popular alternative to base-R
plotting (when using <code>maptiles</code> and <code>sf</code> we are
still essentiall using base R graphics). The relevant functions for
<code>ggplot2</code> are <code>geom_sf()</code> and
<code>annotation_raster()</code>, as the code below shows. We also make
use of:</p>
<ul>
<li><code>get_map()</code> and related functions in the
<code>ggmap</code> package, to obtain georeferenced raster images based
on tiles from map servers;</li>
<li><code>annotation_scale()</code> and
<code>annotation_north_arrow()</code> functions in the
<code>ggspatial</code> package to add essential map annotations.</li>
</ul>
<p>As with <code>maptiles</code> maps, we need to specify a rectangle
for our map background raster. In this example we're going to use the
object <code>locality</code> that we made previously, and convert it to
WGS84 Long-Lat (EPSG:4326) using <code>st_transform()</code>, as this is
the CRS required by <code>ggmap</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Find long-lat bounding coordinates for ggmap raster background:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Find long-lat bounding coordinates for ggmap raster background:</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>(ll <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(locality, <span class="at">crs=</span><span class="fu">st_crs</span>(<span class="dv">4326</span>)) <span class="sc">|&gt;</span> <span class="fu">st_bbox</span>() <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>())</span></code></pre></div>
<pre><code>## [1] 115.75097 -31.98604 115.79889 -31.96359</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># transform the site boundary data to new CRS </span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>LC_siteLL <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(LC_site, <span class="at">crs=</span><span class="fu">st_crs</span>(<span class="dv">4326</span>))</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># convert to sf:: object of class `polygon`</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>study <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">as.matrix</span>(<span class="fu">st_coordinates</span>(LC_siteLL)))) <span class="sc">|&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="at">crs=</span><span class="fu">st_crs</span>(<span class="dv">4326</span>)) </span></code></pre></div>
<p>This example uses <code>stamen_terrain</code> map tiles from Stadia.
In <code>ggmap</code>, the Stadia maps can be specified from a
user-defined rectangle (which is usually what we want), but other map
tiles (e.g. google) yield square maps around a central coordinate. The
<code>get_stadiamap()</code> function creates a georeferenced raster
image from Stadia Stamen map tiles, which can be plotted directly using
<code>ggmap()</code>. We're going to use <code>ggplot()</code> instead,
as it is then easier to add additional map layers such as the
investigation site boundary, stormwater drains, land use polygons, and
so on. In this case we use <code>annotation_raster</code> to add the
<code>ggmap</code> raster to our map plot.</p>
<blockquote>
<p>You will need to <a href="https://stadiamaps.com/stamen"
target="_blank">register</a> for a (free) API key if you want to use
Stadia Stamen map tiles.</p>
</blockquote>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">register_stadiamaps</span>(<span class="at">key =</span> smapskey) <span class="co"># do this before getting Stadia Stamen maps</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>localgg <span class="ot">&lt;-</span> </span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="fu">get_stadiamap</span>(<span class="at">bbox=</span><span class="fu">c</span>(<span class="at">left=</span>ll[<span class="dv">1</span>], <span class="at">bottom=</span>ll[<span class="dv">2</span>], <span class="at">right=</span>ll[<span class="dv">3</span>], <span class="at">top=</span>ll[<span class="dv">4</span>]),</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>                     <span class="at">maptype =</span> <span class="st">&quot;stamen_terrain&quot;</span>, <span class="at">zoom=</span><span class="dv">15</span>)</span></code></pre></div>
<p>Here's how we plot the map background, additional map layers, and
annotations (Figure 4).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># make an object to contain custom plot colours</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Storm_Drains&quot;</span><span class="ot">=</span><span class="st">&quot;darkcyan&quot;</span>, <span class="st">&quot;Study_Area&quot;</span><span class="ot">=</span><span class="st">&quot;#800080b0&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co"># plot the `ggmap` raster starting with an empty `ggplot()`</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="fu">annotation_raster</span>(localgg, <span class="at">xmin=</span>ll[<span class="dv">1</span>], <span class="at">ymin=</span>ll[<span class="dv">2</span>], <span class="at">xmax=</span>ll[<span class="dv">3</span>], <span class="at">ymax=</span>ll[<span class="dv">4</span>]) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">limits=</span><span class="fu">c</span>(ll[<span class="dv">1</span>],ll[<span class="dv">3</span>])) <span class="sc">+</span> </span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">limits=</span><span class="fu">c</span>(ll[<span class="dv">2</span>],ll[<span class="dv">4</span>])) <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="co"># xlim(c(ll[1],ll[3])) + ylim(c(ll[2], ll[4])) + </span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>study, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">col=</span><span class="st">&quot;Study_Area&quot;</span>), <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">lwd=</span><span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>Claremont_drains, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">col=</span><span class="st">&quot;Storm_Drains&quot;</span>), </span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>          <span class="at">lwd=</span><span class="fl">0.8</span>, <span class="at">lty=</span><span class="st">&quot;21&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">115.76</span>,<span class="fl">115.778</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">31.968</span>,<span class="sc">-</span><span class="fl">31.973</span>), </span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>                <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;Military</span><span class="sc">\n</span><span class="st">Facility&quot;</span>,<span class="st">&quot;Study</span><span class="sc">\n</span><span class="st">Area&quot;</span>),</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>                <span class="at">fontface=</span><span class="st">&quot;italic&quot;</span>, <span class="at">family=</span><span class="st">&quot;sans&quot;</span>), </span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>            <span class="at">size=</span><span class="dv">12</span>, <span class="at">vjust=</span><span class="fl">0.5</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">color=</span><span class="st">&quot;steelblue4&quot;</span>, <span class="at">size.unit=</span><span class="st">&quot;pt&quot;</span>) <span class="sc">+</span> </span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">115.771</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">31.9818</span>, </span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>                <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;Fremantle Railway&quot;</span>),</span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>                <span class="at">fontface=</span><span class="st">&quot;italic&quot;</span>, <span class="at">family=</span><span class="st">&quot;sans&quot;</span>), <span class="at">angle=</span><span class="dv">18</span>, </span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>            <span class="at">size=</span><span class="dv">10</span>, <span class="at">vjust=</span><span class="fl">0.5</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">color=</span><span class="st">&quot;steelblue4&quot;</span>, <span class="at">size.unit=</span><span class="st">&quot;pt&quot;</span>) <span class="sc">+</span> </span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">115.752</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">31.9725</span>), </span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>                <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;Indian Ocean&quot;</span>),</span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a>                <span class="at">fontface=</span><span class="st">&quot;italic&quot;</span>, <span class="at">family=</span><span class="st">&quot;sans&quot;</span>), <span class="at">angle=</span><span class="dv">90</span>,</span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a>            <span class="at">size=</span><span class="dv">12</span>, <span class="at">vjust=</span><span class="fl">0.5</span>, <span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">color=</span><span class="st">&quot;navy&quot;</span>, <span class="at">size.unit=</span><span class="st">&quot;pt&quot;</span>) <span class="sc">+</span> </span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Longitude&quot;</span>, <span class="at">y=</span><span class="st">&quot;Latitude&quot;</span>) <span class="sc">+</span> </span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name=</span><span class="st">&quot;&quot;</span>, <span class="at">values=</span>cols, </span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a>                     <span class="at">guide=</span><span class="fu">guide_legend</span>()) <span class="sc">+</span></span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location=</span><span class="st">&quot;tl&quot;</span>, <span class="at">width_hint=</span><span class="fl">0.25</span>, <span class="at">text_cex=</span><span class="dv">1</span>, </span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a>                   <span class="at">pad_x=</span><span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>)) <span class="sc">+</span></span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">&quot;tl&quot;</span>, <span class="at">which_north =</span> <span class="st">&quot;true&quot;</span>, </span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a>                         <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>), <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a>                         <span class="at">style =</span> north_arrow_fancy_orienteering) <span class="sc">+</span></span>
<span id="cb15-32"><a href="#cb15-32" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb15-33"><a href="#cb15-33" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>, <span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb15-34"><a href="#cb15-34" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb15-35"><a href="#cb15-35" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))</span></code></pre></div>
<div class="figure">
<img src="maps-location-siteplan_files/figure-html/plot-ggmap-1.png" alt="Figure 4: Locality map for Lake Claremont made using `ggplot2` and `ggmap`." width="921.6" />
<p class="caption">
Figure 4: Locality map for Lake Claremont made using
<code>ggplot2</code> and <code>ggmap</code>.
</p>
</div>
<p>Some additional notes on this code:</p>
<ul>
<li><code>scale_x_continuous(expand = c(0,0), limits=c(ll[1],ll[3]))</code>
(and <code>scale_y_continuous()</code>) allow us to have axis limits
that exactly fit the <code>ggmap</code> raster</li>
<li><code>geom_sf()</code> allows us to add layers. The layer
information eeds to be in a <code>sf</code> object</li>
<li>we can add text annotations using <code>geom_text()</code></li>
<li>we set axis labels using <code>labs()</code></li>
<li><code>scale_color_manual()</code> creates the legend to the right of
the map</li>
<li><code>annotation_scale()</code> adds a scale bar (based on the CRS
of the raster)</li>
<li><code>annotation_north_arrow()</code> adds a north arrow</li>
<li><code>theme_bw</code> is a good choice for maps</li>
<li>we often want to customise the appearance further by calling
<code>theme()</code> directly and setting some additional options.</li>
</ul>
<hr style="height: 2px; background-color: #5560A4;" />
<p> </p>
</div>
</div>
<div id="site-plan-map" class="section level1">
<h1>SITE PLAN MAP</h1>
<p>Australian guidelines for reporting on preliminary (PSI) and detailed
(DSI) site investigations (NEPC, 2011) also specify including a Site
Plan drawn to a scale appropriate to project size and required detail.
This plan is essentially a map showing features such as site boundary,
sample locations, actual installed locations of monitoring wells,
boreholes and/or pits, and so on (DWER, 2021). The Site Plan should also
be used for reporting results, including “… a clear representation of
contamination issues associated with the site…” (NEPC, 2011).</p>
<p>This section will explain the creation of such a more detailed Site
map in R, including information on potential contamination at discrete
sampling points.</p>
<p>We already have an object <code>LC_site</code> that defines the
boundaries of the site so we can use that to specify the area of map
tiles to download. Note that we are choosing a different map tile style
- the CartoDB tiles have lighter colours, so are good for showing data
on.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>LC_siteMap <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(LC_site, <span class="at">provider=</span><span class="st">&quot;CartoDB.Voyager&quot;</span>, <span class="at">crop=</span><span class="cn">TRUE</span>,</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>                          <span class="at">zoom=</span><span class="dv">16</span>)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mgp=</span><span class="fu">c</span>(<span class="fl">1.5</span>,<span class="fl">0.3</span>,<span class="dv">0</span>), <span class="at">font.lab=</span><span class="dv">2</span>)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_coordinates</span>(LC_site), <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">xaxs=</span><span class="st">&quot;i&quot;</span>, <span class="at">yaxs=</span><span class="st">&quot;i&quot;</span>, </span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Easting&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Northing&quot;</span>)</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="fu">plot_tiles</span>(LC_siteMap, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="fu">box</span>()</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="fu">addnortharrow</span>()</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="fu">addscalebar</span>(<span class="at">plotepsg =</span> <span class="dv">32750</span>, <span class="at">pos=</span><span class="st">&quot;bottomright&quot;</span>, <span class="at">label.col =</span> <span class="dv">1</span>, <span class="at">linecol =</span> <span class="dv">1</span>,</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>            <span class="at">label.cex =</span> <span class="fl">1.2</span>, <span class="at">htin=</span><span class="fl">0.15</span>, <span class="at">widthhint=</span><span class="fl">0.3</span>, <span class="at">padin=</span><span class="fu">c</span>(<span class="fl">0.15</span>,<span class="fl">0.2</span>))</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;UTM Zone 50S, WGS84 (EPSG:32750)&quot;</span>, <span class="at">side=</span><span class="dv">1</span>, <span class="at">line=</span><span class="sc">-</span><span class="fl">1.1</span>, </span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>      <span class="at">font=</span><span class="dv">2</span>, <span class="at">col=</span><span class="dv">14</span>, <span class="at">cex=</span><span class="fl">0.7</span>, <span class="at">adj=</span><span class="fl">0.98</span>)</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="fu">shadowtext</span>(<span class="fu">c</span>(<span class="dv">384450</span>), <span class="fu">c</span>(<span class="dv">6462180</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Rehabilitated bushland&quot;</span>),</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>           <span class="at">bg=</span><span class="dv">11</span>, <span class="at">col=</span><span class="dv">6</span>, <span class="at">srt=</span><span class="dv">30</span>)</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="fu">shadowtext</span>(<span class="fu">c</span>(<span class="dv">384300</span>,<span class="dv">384650</span>,<span class="dv">384680</span>), <span class="fu">c</span>(<span class="dv">6461500</span>,<span class="dv">6461850</span>,<span class="dv">6461440</span>), </span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>           <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Scotch College</span><span class="sc">\n</span><span class="st">sports fields&quot;</span>,<span class="st">&quot;Grassed</span><span class="sc">\n</span><span class="st">Parkland&quot;</span>,</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>                    <span class="st">&quot;Golf</span><span class="sc">\n</span><span class="st">course&quot;</span>), <span class="at">bg=</span><span class="dv">11</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="dv">14</span>,<span class="dv">6</span>,<span class="dv">6</span>), <span class="at">font=</span><span class="dv">3</span>)</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="fu">plot</span>(Claremont_drains[<span class="dv">2</span>], <span class="at">add=</span>T, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="dv">4</span>, <span class="at">lwd=</span><span class="fl">1.5</span>, <span class="at">lty=</span><span class="dv">3</span>)</span></code></pre></div>
<div class="figure">
<img src="maps-location-siteplan_files/figure-html/plot-site-plan-map-1.png" alt="Figure f: Site Plan map made with georeferenced tiles obtained with `maptiles`, with `prettymapr` north arrow and scale bar, and stormwater drains." width="489.6" />
<p class="caption">
Figure f: Site Plan map made with georeferenced tiles obtained with
<code>maptiles</code>, with <code>prettymapr</code> north arrow and
scale bar, and stormwater drains.
</p>
</div>
<p> </p>
<p>We need to read-in our data:<br /> (this is the same one used for the
regression assignment – save it to your working directory in
RStudio!)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="do">## lcw24 &lt;- read.csv(&quot;lcw24edit.csv&quot;)</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="fu">str</span>(lcw24) <span class="co"># check it</span></span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    51 obs. of  11 variables:
##  $ Lab.Field.Group: chr  &quot;Group-01&quot; &quot;Group-01&quot; &quot;Group-01&quot; &quot;Group-01&quot; ...
##  $ Sample_ID      : chr  &quot;LCW24_01&quot; &quot;LCW24_02&quot; &quot;LCW24_03&quot; &quot;LCW24_04&quot; ...
##  $ Location       : chr  &quot;North-west lake&quot; &quot;North-west lake&quot; &quot;North-west lake&quot; &quot;North-west lake&quot; ...
##  $ Easting        : int  384411 384405 384402 384411 384415 384346 384559 384568 384576 384585 ...
##  $ Northing       : int  6462067 6462067 6462065 6462075 6462080 6461978 6461907 6461927 6461947 6461967 ...
##  $ Zone           : chr  &quot;NW&quot; &quot;NW&quot; &quot;NW&quot; &quot;NW&quot; ...
##  $ pH             : num  7.43 7.51 7.57 7.46 7.46 8.56 7.76 7.4 7.72 7.64 ...
##  $ As             : num  0.166 0.158 0.148 0.182 0.14 0.158 NA NA 0.043 NA ...
##  $ Fe             : num  0.283 0.168 0.109 0.073 0.054 0.021 0.174 0.065 0.699 0.334 ...
##  $ P              : num  0.353 0.295 0.292 0.461 0.359 0.043 0.028 0.014 0.061 0.056 ...
##  $ Pb             : num  NA NA NA 0.0246 NA NA NA NA NA NA ...</code></pre>
<p>We can optionally check sample locations (small <code>+</code>
symbols):</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># ...continuing previous code for Figure 4...</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">with</span>(lcw24, <span class="fu">points</span>(Easting, Northing, <span class="at">pch=</span><span class="dv">3</span>, <span class="at">col=</span><span class="dv">14</span>, <span class="at">cex=</span><span class="fl">0.7</span>))</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">bg=</span><span class="st">&quot;#ffffffb0&quot;</span>, <span class="at">box.col=</span><span class="dv">12</span>, </span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Storm drains&quot;</span>,<span class="st">&quot;Water samples&quot;</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="cn">NA</span>), <span class="at">pch=</span><span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">3</span>),</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">14</span>), <span class="at">pt.cex=</span><span class="fu">c</span>(<span class="cn">NA</span>,<span class="fl">0.7</span>))</span></code></pre></div>
<div class="figure">
<img src="maps-location-siteplan_files/figure-html/siteplan-sample-locations-1.png" alt="Figure 6: Site Plan map made with georeferenced tiles obtained with `maptiles`, with `prettymapr` north arrow and scale bar, stormwater drains, and locations of water samples." width="489.6" />
<p class="caption">
Figure 6: Site Plan map made with georeferenced tiles obtained with
<code>maptiles</code>, with <code>prettymapr</code> north arrow and
scale bar, stormwater drains, and locations of water samples.
</p>
</div>
<p> </p>
<div
id="plot-the-p-phosphorus-concentrations-as-bubbles-using-the-symbols-function"
class="section level3">
<h3>Plot the P (phosphorus) concentrations as ‘bubbles’ using the
<code>symbols()</code> function</h3>
<p>The base-R <code>symbols()</code> function allows us to add the
scaled circle symbols ("bubbles"). Note that we make bubble radius
proportional to <em>square root</em> concentration – this makes bubble
<em>area</em> proportional to concentration, since human perception
considers size as area rather than diameter or radius.</p>
<p>Make sure you use these option in the <code>symbols()</code>
function: <code>add=TRUE</code>, <code>inches=FALSE</code>.</p>
<p>We also identify and plot the samples with P concentrations greater
than the threshold for total P in wetlands in SW Australia (ANZECC,
2000), which is 60 µg/L = 0.06 mg/L</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># ...continuing previous code...</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="co"># first use a simple algorithm to estimate a scale factor `s0` for the bubbles</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  axrg <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="st">&quot;usr&quot;</span>)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">par</span>(<span class="st">&quot;usr&quot;</span>)[<span class="dv">1</span>]</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="co"># first make small legend bubble, checking if it&#39;s zero </span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">pretty</span>(lcw24<span class="sc">$</span>P)[<span class="dv">1</span>] <span class="sc">&lt;</span> <span class="fl">0.001</span>) {</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>    bublo <span class="ot">&lt;-</span> <span class="fu">pretty</span>(lcw24<span class="sc">$</span>P)[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>    bublo <span class="ot">&lt;-</span> <span class="fu">pretty</span>(lcw24<span class="sc">$</span>P)[<span class="dv">1</span>]</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  }</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>  bubhi <span class="ot">&lt;-</span> <span class="fu">pretty</span>(lcw24<span class="sc">$</span>P)[<span class="fu">length</span>(<span class="fu">pretty</span>(lcw24<span class="sc">$</span>P))]</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>  s0 <span class="ot">&lt;-</span> <span class="fu">signif</span>(<span class="fl">0.05</span><span class="sc">*</span>axrg<span class="sc">/</span><span class="fu">sqrt</span>(bubhi),<span class="dv">2</span>)</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>  </span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co"># add the scaled symbols (&quot;bubbles&quot;)</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="co"># note we make bubble radius proportional to square root concentration</span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co"># this makes bubble area proportional to concentration, since human perception</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="co"># considers size as area rather than diameter or radius</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a><span class="fu">with</span>(lcw24, <span class="fu">symbols</span>(Easting, Northing, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">circles=</span><span class="fu">sqrt</span>(P)<span class="sc">*</span>s0, </span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>                    <span class="at">inches=</span><span class="cn">FALSE</span>, <span class="at">fg=</span><span class="dv">2</span>, <span class="at">bg=</span><span class="st">&quot;#A020F080&quot;</span>))</span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a><span class="co"># next we identify and plot the samples with P concentrations greater than </span></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a><span class="co"># the ANZECC threshold for total P in wetlands in SW Australia, which is</span></span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a><span class="co"># 60µg/L = 0.06mg/L</span></span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a><span class="fu">with</span>(lcw24[<span class="fu">which</span>(lcw24<span class="sc">$</span>P<span class="sc">&gt;=</span><span class="fl">0.06</span>),<span class="fu">c</span>(<span class="st">&quot;Easting&quot;</span>,<span class="st">&quot;Northing&quot;</span>,<span class="st">&quot;P&quot;</span>)],</span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a>     <span class="fu">points</span>(Easting, Northing, <span class="at">pch=</span><span class="dv">3</span>, <span class="at">col=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="fl">2.5</span>))</span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a><span class="co"># manual legend</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a><span class="fu">rect</span>(<span class="dv">384400</span>, <span class="dv">6462190</span>, <span class="dv">384620</span>, <span class="dv">6462330</span>, <span class="at">lwd=</span><span class="dv">2</span>, </span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a>     <span class="at">col=</span><span class="st">&quot;#ffffffb0&quot;</span>, <span class="at">border=</span><span class="st">&quot;#80808080&quot;</span>)</span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a><span class="fu">symbols</span>(<span class="fu">c</span>(<span class="dv">384450</span>,<span class="dv">384550</span>),<span class="fu">c</span>(<span class="dv">6462250</span>,<span class="dv">6462250</span>), <span class="at">circles=</span>s0<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">c</span>(bublo,bubhi)), <span class="at">add=</span>T,</span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a>        <span class="at">lwd=</span><span class="dv">1</span>, <span class="at">inches=</span>F, <span class="at">fg =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">bg =</span> <span class="st">&quot;#8000FF40&quot;</span>)</span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">c</span>(<span class="dv">384500</span>,<span class="dv">384450</span>,<span class="dv">384550</span>),<span class="fu">c</span>(<span class="dv">6462320</span>,<span class="dv">6462230</span>,<span class="dv">6462250</span>), <span class="at">cex=</span><span class="fl">0.85</span>, </span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a>     <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;P (mg/L)&quot;</span>,bublo,bubhi), <span class="at">pos =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">font=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a>     <span class="at">offset=</span><span class="dv">0</span>)</span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a></span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a><span class="co"># &quot;normal&quot; legend</span></span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">inset=</span><span class="fl">0.01</span>, <span class="at">bg=</span><span class="st">&quot;#ffffffa0&quot;</span>, <span class="at">box.col=</span><span class="dv">12</span>, <span class="at">y.intersp=</span><span class="fl">1.75</span>,</span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Water</span><span class="sc">\n</span><span class="st">samples&quot;</span>, <span class="st">&quot;Samples</span><span class="sc">\n</span><span class="st">P ≥ 0.06mg/L&quot;</span>, <span class="st">&quot;Stormwater</span><span class="sc">\n</span><span class="st">drains&quot;</span>),</span>
<span id="cb20-37"><a href="#cb20-37" tabindex="-1"></a>       <span class="at">pch=</span><span class="fu">c</span>(<span class="dv">21</span>,<span class="dv">3</span>,<span class="cn">NA</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="dv">3</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">4</span>), <span class="at">lwd=</span><span class="fu">c</span>(<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="fl">1.5</span>),</span>
<span id="cb20-38"><a href="#cb20-38" tabindex="-1"></a>       <span class="at">pt.cex=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="cn">NA</span>), <span class="at">pt.lwd=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">2.5</span>,<span class="cn">NA</span>), <span class="at">pt.bg=</span><span class="st">&quot;#A020F080&quot;</span>, <span class="at">cex=</span><span class="fl">0.85</span>)</span></code></pre></div>
<div class="figure">
<img src="maps-location-siteplan_files/figure-html/siteplan-bubbles-1.png" alt="Figure 7: Site Plan map made with georeferenced tiles obtained with `maptiles`, with `prettymapr` north arrow and scale bar, and stormwater drains. Phosphorus concentrations in water are shown are area-proportional circle symbols at sample locations, with samples having phosphorus concentrations exceeding the Water Quality Australia guideline shown by bold plus (+) symbols." width="489.6" />
<p class="caption">
Figure 7: Site Plan map made with georeferenced tiles obtained with
<code>maptiles</code>, with <code>prettymapr</code> north arrow and
scale bar, and stormwater drains. Phosphorus concentrations in water are
shown are area-proportional circle symbols at sample locations, with
samples having phosphorus concentrations exceeding the Water Quality
Australia guideline shown by bold plus (+) symbols.
</p>
</div>
<p> </p>
<p>This final map could be included in an environmental investigation
report.</p>
<p>To plot a different element (<em>e.g</em>. Al) you would need to</p>
<ol style="list-style-type: decimal">
<li>Replace 'P' with 'Al' in ALL the right places in the code</li>
<li>Change the guideline concentration from 0.06 to the relevant value
for the next element (see Water Quality Australia, 2024)</li>
</ol>
<hr style="height: 2px; background-color: #5560A4;" />
</div>
<div id="site-plan-map-using-ggplot2-and-ggmap" class="section level2">
<h2>Site plan map using <code>ggplot2</code> and <code>ggmap</code></h2>
<p>We have already converted our site polygon to the correct CRS
(<em>i.e</em>. Long-Lat WGS84), storing it in <code>LC_siteLL</code>. To
make a background map we add some space around the site polygon – we
could do this manually, but I've made a <a
href="https://github.com/Ratey-AtUWA/Learn-R-web/blob/main/FUNCTION-pad_bbox.R"
target="_blank">custom function</a> <code>pad_bbox()</code> to do this
simply (<code>pad_bbox()</code> expands the bounding box by 5% in all
directions by default; we can change the expansion factor).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co">#    (pad_bbox() is a custom function to expand a sf:: object in </span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="co">#     all directions by a specified proportion)</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;https://github.com/Ratey-AtUWA/Learn-R-web/raw/refs/heads/main/FUNCTION-pad_bbox.R&quot;</span>)</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>l2 <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">pad_bbox</span>(LC_siteLL)) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>sitegg <span class="ot">&lt;-</span> </span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  <span class="fu">get_stadiamap</span>(<span class="at">bbox=</span><span class="fu">c</span>(<span class="at">left=</span>l2[<span class="dv">1</span>], <span class="at">bottom=</span>l2[<span class="dv">2</span>], <span class="at">right=</span>l2[<span class="dv">3</span>], <span class="at">top=</span>l2[<span class="dv">4</span>]),</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>                     <span class="at">maptype =</span> <span class="st">&quot;stamen_terrain&quot;</span>, <span class="at">zoom=</span><span class="dv">16</span>)</span></code></pre></div>
<p>We need our data in the right format, so we need to do some
conversions (data frame to <code>sf</code> data frame, and UTM Zone 50
(EPSG 32750) to Longitude-Latitude WGS 84 (EPSG:4326):</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>lcw24LL <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(lcw24, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">&quot;Easting&quot;</span>, <span class="st">&quot;Northing&quot;</span>),</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>                    <span class="at">crs=</span><span class="fu">st_crs</span>(<span class="dv">32750</span>), <span class="at">remove=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="fu">st_crs</span>(<span class="dv">4326</span>))</span></code></pre></div>
<p>Here's how we use <code>ggplot</code> to plot the map background,
additional map layers, annotations, and <strong>data</strong> (Figure
8).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># make an object to contain custom plot colours</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Storm_Drains&quot;</span><span class="ot">=</span><span class="st">&quot;darkcyan&quot;</span>, <span class="st">&quot;Study_Area&quot;</span><span class="ot">=</span><span class="st">&quot;#800080b0&quot;</span>)</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co"># plot the `ggmap` raster starting with an empty `ggplot()`</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="fu">ggplot</span>(LC_siteLL) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>  <span class="fu">annotation_raster</span>(sitegg, <span class="at">xmin=</span>l2[<span class="dv">1</span>], <span class="at">ymin=</span>l2[<span class="dv">2</span>], <span class="at">xmax=</span>l2[<span class="dv">3</span>], <span class="at">ymax=</span>l2[<span class="dv">4</span>]) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">limits=</span><span class="fu">c</span>(l2[<span class="dv">1</span>],l2[<span class="dv">3</span>])) <span class="sc">+</span> </span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">limits=</span><span class="fu">c</span>(l2[<span class="dv">2</span>],l2[<span class="dv">4</span>])) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>study, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">lwd=</span><span class="fl">1.3</span>, <span class="at">color=</span><span class="st">&quot;#800080b0&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>Claremont_drains, <span class="at">lwd=</span><span class="fl">0.8</span>, <span class="at">lty=</span><span class="st">&quot;21&quot;</span>, <span class="at">col=</span><span class="st">&quot;darkcyan&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>lcw24LL, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">size=</span>P, <span class="at">fill=</span>P), <span class="at">pch=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">&quot;#00000080&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span><span class="fu">subset</span>(lcw24LL, lcw24LL<span class="sc">$</span>P<span class="sc">&gt;=</span><span class="fl">0.06</span>), <span class="at">pch=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&quot;#ffffff40&quot;</span>, <span class="at">stroke=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span><span class="fu">subset</span>(lcw24LL, lcw24LL<span class="sc">$</span>P<span class="sc">&gt;=</span><span class="fl">0.06</span>), <span class="at">pch=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">alpha=</span><span class="fl">0.7</span>, <span class="at">option=</span><span class="st">&quot;plasma&quot;</span>, </span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>                       <span class="at">breaks=</span><span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.02</span>, <span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>), </span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a>                       <span class="at">guide=</span><span class="st">&quot;legend&quot;</span>, <span class="at">name=</span><span class="st">&quot;P (mg/L)&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>), <span class="at">breaks=</span><span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.02</span>, <span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>), </span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a>                        <span class="at">name=</span><span class="st">&quot;P (mg/L)&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Longitude&quot;</span>, <span class="at">y=</span><span class="st">&quot;Latitude&quot;</span>) <span class="sc">+</span> </span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fl">115.7755</span>, <span class="at">y=</span><span class="sc">-</span><span class="fl">31.9765</span>, <span class="at">label =</span> <span class="st">&quot;Sports</span><span class="sc">\n</span><span class="st">Fields&quot;</span>),</span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a>            <span class="at">fontface=</span><span class="st">&quot;italic&quot;</span>, <span class="at">family=</span><span class="st">&quot;sans&quot;</span>, <span class="at">color=</span><span class="st">&quot;#205000&quot;</span>, </span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a>            <span class="at">size.unit=</span><span class="st">&quot;pt&quot;</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">vjust=</span><span class="fl">0.5</span>, <span class="at">hjust=</span><span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fl">115.78</span>, <span class="at">y=</span><span class="sc">-</span><span class="fl">31.9775</span>, <span class="at">label =</span> <span class="st">&quot;Golf and</span><span class="sc">\n</span><span class="st">Swimming</span><span class="sc">\n</span><span class="st">Complex&quot;</span>),</span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a>            <span class="at">fontface=</span><span class="st">&quot;italic&quot;</span>, <span class="at">family=</span><span class="st">&quot;sans&quot;</span>, <span class="at">color=</span><span class="st">&quot;#205000&quot;</span>, </span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a>            <span class="at">size.unit=</span><span class="st">&quot;pt&quot;</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">vjust=</span><span class="fl">0.5</span>, <span class="at">hjust=</span><span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location=</span><span class="st">&quot;bl&quot;</span>, <span class="at">width_hint=</span><span class="fl">0.25</span>, <span class="at">text_cex=</span><span class="fl">0.9</span>, </span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a>                   <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">&quot;cm&quot;</span>)) <span class="sc">+</span></span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location=</span><span class="st">&quot;tl&quot;</span>, <span class="at">which_north=</span><span class="st">&quot;true&quot;</span>, </span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a>                         <span class="at">pad_x=</span><span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>), <span class="at">pad_y=</span><span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>), </span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a>                         <span class="at">width=</span><span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>), <span class="at">height=</span><span class="fu">unit</span>(<span class="fl">1.2</span>, <span class="st">&quot;cm&quot;</span>)) <span class="sc">+</span></span>
<span id="cb23-30"><a href="#cb23-30" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb23-31"><a href="#cb23-31" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>, <span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb23-32"><a href="#cb23-32" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>),</span>
<span id="cb23-33"><a href="#cb23-33" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>))</span></code></pre></div>
<div class="figure">
<img src="maps-location-siteplan_files/figure-html/plot-gg-sitemap-1.png" alt="Figure 8: Site Plan map for Lake Claremont made using `ggplot2` and `ggmap`, showing concentration of P as area-proportional symbols. Samples for which total P concentration exceed the stressor value (ANZECC/ARMCANZ 2000) are identified with + symbols." width="528" />
<p class="caption">
Figure 8: Site Plan map for Lake Claremont made using
<code>ggplot2</code> and <code>ggmap</code>, showing concentration
of P as area-proportional symbols.
Samples for which total P concentration exceed the stressor value
(ANZECC/ARMCANZ 2000) are identified with + symbols.
</p>
</div>
<p>Notes on the <code>ggplot</code> Site Plan map code:</p>
<ul>
<li>some code features perform the same function as for trhe locality
map in Figure 4</li>
<li>to make a "bubble" plot we include <code>aes(size=P, fill=P)</code>
within <code>geom_sf(data=lcw24LL, ...)</code></li>
<li>we plot the symbols <strong>twice</strong> for the subset of data
where our variable (<code>P</code>) exceeds the guideline concentration
– this is to improve visibility, since the underlying symbol has a
thicker line width (<code>stroke</code>) and contrasting semitransparent
colour</li>
<li>we have done some careful <em>matching</em> of
<code>scale_fill_viridis_c()</code> and
<code>scale_size_continuous()</code> so that we just get a single legend
instead of one for size and one for fill colour</li>
</ul>
<p> </p>
</div>
<div id="references-and-r-packages" class="section level2">
<h2>References and R packages</h2>
<p>ANZECC/ARMCANZ. (2000). <em>Australian and New Zealand Guidelines for
Fresh</em> <em>and Marine Water Quality (Volume 1, The guidelines)</em>.
Australian and New Zealand Environment and Conservation Council,
Agriculture and Resource Management Council of Australia and New Zealand
<a
href="https://www.waterquality.gov.au/sites/default/files/documents/anzecc-armcanz-2000-guidelines-vol1.pdf"
target="_blank">https://www.waterquality.gov.au/sites/default/files/documents/anzecc-armcanz-2000-guidelines-vol1.pdf</a>
– <strong>see Table 3.3.6</strong>.</p>
<p>Dunnington, Dewey (2017). <code>prettymapr</code>: <em>Scale Bar,
North Arrow, and Pretty Margins in R</em>. R package version 0.2.2. <a
href="https://CRAN.R-project.org/package=prettymapr"
target="_blank">https://CRAN.R-project.org/package=prettymapr</a>.</p>
<p>Dunnington, D. (2023). <code>ggspatial</code>: <em>Spatial Data
Framework for ggplot2</em>. R package version 1.1.9, <a
href="https://CRAN.R-project.org/package=ggspatial"
target="_blank">https://CRAN.R-project.org/package=ggspatial</a>.</p>
<p>DWER (2021). Assessment and management of contaminated sites.
Department of Water and Environment Regulation, Government of Western
Australia, Joondalup. <a
href="https://www.wa.gov.au/system/files/2023-05/guideline-assessment-and-management-of-contaminated-sites.pdf"
target="_blank">https://www.wa.gov.au/system/files/2023-05/guideline-assessment-and-management-of-contaminated-sites.pdf</a>.</p>
<p>Giraud T (2021). <code>maptiles</code>: <em>Download and Display Map
Tiles</em>. R package version 0.3.0, <a
href="https://CRAN.R-project.org/package=maptiles"
target="_blank">https://CRAN.R-project.org/package=maptiles</a>.</p>
<p>Garnier S, Ross N, Rudis R, Camargo AP, Sciaini M, Scherer C (2024).
<code>viridis(Lite)</code> - <em>Colorblind-Friendly Color Maps for
R</em>. viridis package version 0.6.5. <a
href="https://sjmgarnier.github.io/viridis/"
target="_blank">https://sjmgarnier.github.io/viridis/</a>.</p>
<p>Kahle, D. and Wickham, H. <code>ggmap</code>: Spatial Visualization
with <code>ggplot2</code>. <em>The R Journal</em>,
<strong>5</strong>(1), 144-161. <a
href="http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf"
target="_blank">http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf</a>.</p>
<p>NEPC (National Environment Protection Council). (2011). <em>Schedule
B2: Guideline on Site Characterisation</em>, National Environment
Protection (Assessment of Site Contamination) Measure (Amended).
Commonwealth of Australia, Canberra. <a
href="https://www.nepc.gov.au/sites/default/files/2022-09/schedule-b2-guideline-site-characterisation-sep10.pdf"
target="_blank">https://www.nepc.gov.au/.../schedule-b2-guideline-site-characterisation-sep10.pdf</a>.</p>
<p>Pebesma, E., 2018. Simple Features for R: Standardized Support for
Spatial VectorData. <em>The R Journal</em> <strong>10</strong> (1),
439-446, <a href="https://doi.org/10.32614/RJ-2018-009"
target="_blank">https://doi.org/10.32614/RJ-2018-009</a> . (package
<code>sf</code>)</p>
<p>Water Quality Australia. (2024). Search for toxicant default
guideline values for the protection of aquatic ecosystems. Department of
Climate Change, Energy, the Environment and Water, Government of
Australia. <a
href="https://www.waterquality.gov.au/anz-guidelines/guideline-values/default/water-quality-toxicants/search"
target="_blank">https://www.waterquality.gov.au/anz-guidelines/guideline-values/default/water-quality-toxicants/search</a>.</p>
<p>Wickham, H. (2016). <code>ggplot2</code>: <em>Elegant Graphics for
Data Analysis</em>. Springer-Verlag New York, 2016. <a
href="https://ggplot2.tidyverse.org"
target="_blank">https://ggplot2.tidyverse.org</a>.</p>
<hr style="height: 2px; background-color: #5560A4;" />
<p> </p>
</div>
<div id="for-uwa-students" class="section level2">
<h2>For UWA students</h2>
</div>
</div>
<div id="TandL"
style="border: 2px solid #039; background-color:#fec; padding: 8px;">
<div id="activities-for-this-workshop-class" class="section level1">
<h1>Activities for this Workshop class</h1>
<p><img src="./images/sample_loc_maps_afw19_afs19.png" align="right"
width="201" height="298" /> There are a few items available <strong>on
the UWA LMS</strong> as learning materials for this session on
<strong>using R + packages to make maps</strong>: two short videos, and
two annotated pdfs based on</p>
<ol style="list-style-type: decimal">
<li>the R code and</li>
<li>a PowerPoint presentation.</li>
</ol>
<p>We suggest going through the first video first, and then trying the
code, and finally viewing the second video and trying some different
things. The material in the PowerPoint presentation on interpolation of
point data is completely optional.</p>
For activities today we suggest:
<ol>
<li>
Try to make a map of our field site area which covers all our sample
locations. A good place to start after watching the video/reading the
annotated code PDF would be with modifying and running the R code.
</li>
</ol>
<p>
Good luck!
</p>
</div>
</div>
<p> </p>
<div id="bonus-material" class="section level3"
style="border: 2px solid #039; background-color:#fec; padding: 8px;">
<h3>Bonus material</h3>
<p><span
style="font-family: cambria, serif; background-color:cyan; text-align: center;"> (Currently
on another Github site) </span></p>
<p>
<a href="https://ratey-atuwa.github.io/cybloRg/georef_jpeg_map.html" target="_blank" rel="noopener"><img
src="./images/rcode.png" alt="R code file icon" width="32"
height="32" /></a> <a href="https://ratey-atuwa.github.io/cybloRg/georef_jpeg_map.html" target="_blank" rel="noopener"><strong>R</strong>
code to use georeferenced images <em>(e.g</em>. from NearMap) as map
backgrounds</a><br /> 
</p>
<p>
<a href="https://ratey-atuwa.github.io/cybloRg/Google-kml-R.html" target="_blank" rel="noopener"><img
src="./images/rcode.png" alt="R code file icon" width="32"
height="32" /></a> <a href="https://ratey-atuwa.github.io/cybloRg/Google-kml-R.html" target="_blank" rel="noopener">Digitising
map features from Google Earth, and R code for a function to convert
Google Earth .kml files for use in <strong>R</strong></a>
</p>
<p>
<a href="https://ratey-atuwa.github.io/cybloRg/geostats.html" target="_blank" rel="noopener">Advanced
Spatial Analysis</a> (spatial autocorrelation, variograms, and kriging
interpolations)<br /> 
</p>
<p><span
style="font-family: cambria, serif; background-color:#ffa; text-align: center;"> (Currently
on UWA LMS, so you will need to be logged in) </span></p>
</div>
<p> </p>

<!DOCTYPE html>

<html>
<body>
<hr style="height: 2px; background-color: #003087;" />
<p><span style="font-size:10pt"><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank"><strong>CC-BY-SA</strong></a> • All content by <a href="https://github.com/Ratey-AtUWA" target="_blank">Ratey-AtUWA</a>. My <a href="https://www.uwa.edu.au/schools/agriculture-and-environment" target="_blank">employer</a> does not necessarily know about or endorse the content of this website.</span><br>
<span style="font-size:9pt">Created with <a href="https://bookdown.org/yihui/rmarkdown/" target="_blank"><span style="font-family: monospace;">rmarkdown</span></a> in <a href="https://posit.co/download/rstudio-desktop/" target="_blank"><span class="fa fa-registered"></span> RStudio</a>. Currently using the free <a href="https://bootswatch.com/yeti/" target="_blank"><span style="font-family: monospace;">yeti</span> theme from Bootswatch</a>.</span></p>
</body>
</html>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
